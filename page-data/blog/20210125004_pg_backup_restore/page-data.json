{"componentChunkName":"component---src-templates-blog-js","path":"/blog/20210125004_pg_backup_restore","result":{"pageContext":{"frontmatter":{"id":"20210125004_pg_backup_restore","title":"postgres 数据库的备份与恢复","subtitle":"pg数据库的全备份，以及数据恢复","subject":"运维","author":"Chris Wei","keywords":"数据备份;数据恢复","tags":"postgresql;devops","category":"指导手册","cover":"http://qiniuargus.weready.online/blog/coder.jpg","created_when":"2021-01-25","updated_when":"2021-01-25","level":200},"excerpt":" postgres 数据库的备份与恢复\n\n 参考\n\n-   [1](<>)\n","html":"<h1>postgres 数据库的备份与恢复</h1>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://www.jianshu.com/p/0602d5c77b8f?tdsourcetag=s_pcqq_aiomsg\">1</a></li>\n</ul>\n<h2>备份</h2>\n<h4>命令格式</h4>\n<pre><code>pg_dump -h [host] -U [user] [database] > [output file]\n</code></pre>\n<pre><code>#!/bin/bash\n\npg_dump -h dbpg -U postgres [database] > /backup/pgdump.sql\nmv -f /backup/pgdump.sql /backup/pg_dump_`date +%Y%m%d%H%M%S`.sql\n</code></pre>\n<h2>恢复</h2>\n<h3>Option 1</h3>\n<h4>进入容器 <code>dbpg</code></h4>\n<h4>进入脚本目录</h4>\n<pre><code>cd script\n</code></pre>\n<h4>进入数据库</h4>\n<pre><code>psql -d archellis -U postgres\n</code></pre>\n<h4>清空数据</h4>\n<pre><code>\\i clear_all.sql;\n</code></pre>\n<h4>恢复数据</h4>\n<pre><code>\\i pg_dump_xxxxxxx.sql;\n</code></pre>\n<h3>Option 2</h3>\n<h4>登录数据库</h4>\n<pre><code>psql -U postgres \n</code></pre>\n<h4>断开所有连接</h4>\n<pre><code>SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE datname = 'archellis' AND pid &#x3C;> pg_backend_pid();\n</code></pre>\n<h4>退出登录</h4>\n<pre><code>\\q\n</code></pre>\n<h4>删除数据库</h4>\n<pre><code>dropdb -U postgres [database]\n</code></pre>\n<h4>创建数据库</h4>\n<pre><code>createdb -U postgres [database]\n</code></pre>\n<h4>恢复数据</h4>\n<pre><code>psql -d [database] -U postgres -f pg_dump_xxxxxxxx.sql\n</code></pre>"}},"staticQueryHashes":["2718502863","3159585216","847266990"]}