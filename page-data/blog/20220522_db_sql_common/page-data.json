{
    "componentChunkName": "component---src-templates-blog-js",
    "path": "/blog/20220522_db_sql_common",
    "result": {"pageContext":{"frontmatter":{"id":"20220522_db_sql_common","title":"数据库SQL基础","subtitle":null,"subject":"数据库相关基础知识","authors":"Chris Wei","keywords":null,"tags":"sql;db;database;运维;","category":"经验技巧","cover":"https://media.inkscape.org/media/resources/file/Ladybug-icon.png","videos":null,"created_when":"2021-06-05T00:00:00.000Z","updated_when":"2022-05-22T00:00:00.000Z","level":200},"excerpt":"# 数据库SQL基础\n\n# 创建表\n\n```\nCREATE TABLE t_class (\n  id                  serial not null PRIMARY KEY,\n  name                text,\n  memo                text,\n  balance             int NOT NULL DEFAULT 20,\n  updated_when        timestamp DEFAULT current_timestamp,\n  ex_info             jsonb,\n  UNIQUE           (name)\n);\n\nCREATE TABLE t_student (\n  id                  serial not null PRIMARY KEY,\n  name                text,\n  gender              text NOT NULL DEFAULT 'MALE',\n  age                 int NOT NULL DEFAULT 20,\n  class_id            serial REFERENCES t_class (id)\n);\n\n```\n\n# 增表内加记录\n\n    INSERT INTO t_class (name, memo, balance, ex_info)\n    VALUES\n      ('2022001', 'momo111', 10, '{\"x\": \"123\", \"y\": \"456\"}'),\n      ('2022002', 'momo222', 20, '{\"x\": \"xxx\", \"y\": \"yyy\"}'),\n      ('2022003', 'momo333', 30, '{\"x\": \"123\", \"y\": \"456\"}')\n    ;\n\n    INSERT INTO t_student (name, class_id)\n    VALUES\n      ('Alice', 1),\n      ('Bob', 2),\n      ('Chris', 3),\n      ('Angel', 1),\n      ('Peter', 2),\n      ('Tom', 3),\n      ('Jerry', 1),\n      ('John', 2),\n      ('Jack', 3)\n    ;\n\n# 查询表内加记录\n","html":"<h1>数据库SQL基础</h1>\n<h2>创建表</h2>\n<pre><code>CREATE TABLE t_class (\n  id                  serial not null PRIMARY KEY,\n  name                text,\n  memo                text,\n  balance             int NOT NULL DEFAULT 20,\n  updated_when        timestamp DEFAULT current_timestamp,\n  ex_info             jsonb,\n  UNIQUE           (name)\n);\n\nCREATE TABLE t_student (\n  id                  serial not null PRIMARY KEY,\n  name                text,\n  gender              text NOT NULL DEFAULT 'MALE',\n  age                 int NOT NULL DEFAULT 20,\n  class_id            serial REFERENCES t_class (id)\n);\n\n</code></pre>\n<h2>增表内加记录</h2>\n<pre><code>INSERT INTO t_class (name, memo, balance, ex_info)\nVALUES\n  ('2022001', 'momo111', 10, '{\"x\": \"123\", \"y\": \"456\"}'),\n  ('2022002', 'momo222', 20, '{\"x\": \"xxx\", \"y\": \"yyy\"}'),\n  ('2022003', 'momo333', 30, '{\"x\": \"123\", \"y\": \"456\"}')\n;\n\nINSERT INTO t_student (name, class_id)\nVALUES\n  ('Alice', 1),\n  ('Bob', 2),\n  ('Chris', 3),\n  ('Angel', 1),\n  ('Peter', 2),\n  ('Tom', 3),\n  ('Jerry', 1),\n  ('John', 2),\n  ('Jack', 3)\n;\n</code></pre>\n<h2>查询表内加记录</h2>\n<ul>\n<li>无条件全部记录</li>\n</ul>\n<pre><code>SELECT * FROM t_class;\nSELECT * FROM t_student;\n</code></pre>\n<ul>\n<li>按条件查询</li>\n</ul>\n<pre><code>SELECT * FROM t_class\nWHERE balance=10;\n</code></pre>\n<ul>\n<li>排序</li>\n</ul>\n<pre><code>SELECT * FROM t_class\nORDER BY balance;\n\nSELECT * FROM t_student\nORDER BY class_id, name;\n</code></pre>\n<h2>修改表内加记录</h2>\n<pre><code>UPDATE t_class\nSET memo='update by update'\nWHERE balance=10;\n</code></pre>\n<h2>删除表内加记录</h2>\n<pre><code>DELETE FROM t_student\nWHERE name='John';\n</code></pre>\n<h2>关联表查询</h2>\n<pre><code>SELECT  s.\"name\" as \"sname\", s.\"id\" as \"sid\", c.*\nFROM t_student s\nLEFT JOIN t_class c ON (c.id=s.class_id)\n;\n</code></pre>\n<h2>创建视图</h2>\n<pre><code>CREATE OR REPLACE VIEW v_student AS\n  SELECT  s.\"name\" as \"sname\", s.\"id\" as \"sid\", c.*\n  FROM t_student s\n  LEFT JOIN t_class c ON (c.id=s.class_id)\n;\n</code></pre>\n<pre><code>CREATE OR REPLACE VIEW v_class AS\n    SELECT  c.*,\n            s.name AS sname,\n            json_build_object(\n              'name',     s.name,\n              'gender',   s.gender,\n              'age',      s.age\n            )::JSON AS student\n    FROM t_class c\n    LEFT JOIN t_student s ON c.id=s.class_id\n;\n</code></pre>\n<h3>时间过滤 (mysql)</h3>\n<h4>今天的数据</h4>\n<pre><code>SELECT * FROM 表名 WHERE to_days(时间字段) = to_days(now());\n</code></pre>\n<h4>昨天的数据</h4>\n<pre><code>SELECT * FROM 表名 WHERE to_days(now()) - to_days(时间字段) &#x3C;= 1;\n</code></pre>\n<h4>近7天的数据</h4>\n<pre><code>SELECT * FROM 表名 WHERE date_sub(curdate(), interval 7 day) &#x3C;= date(时间字段);\n</code></pre>"}},
    "staticQueryHashes": ["2877226700","3159585216","3659731985","3670619862"]}