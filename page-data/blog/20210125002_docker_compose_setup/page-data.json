{"componentChunkName":"component---src-templates-blog-js","path":"/blog/20210125002_docker_compose_setup","result":{"pageContext":{"fields":{"filename":"20210125002_docker_compose_setup"},"frontmatter":{"id":"20210125002_docker_compose_setup","title":"Docker Compose 的安装设置","subtitle":"CentOS 下 Docker 和 Docker Compose 的安装配置","subject":"开发环境","author":"Chis Wei","keywords":"Docker;Docker Compose;集成环境","tags":null,"category":"指导手册","cover":"http://qiniuargus.weready.online/blog/app_logos.png","created_when":"2021-01-25","updated_when":"2021-01-25"},"excerpt":"Docker Compose 的安装设置 参考文章 Get Docker Engine - Community for…","html":"<h1>Docker Compose 的安装设置</h1>\n<h2>参考文章</h2>\n<ul>\n<li><a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\">Get Docker Engine - Community for CentOS</a></li>\n<li><a href=\"https://www.cnblogs.com/morang/p/9501223.html\">docker 及 docker-compose 的快速安装和简单使用</a></li>\n</ul>\n<h2>Install Docker</h2>\n<ol>\n<li>SET UP THE REPOSITORY</li>\n</ol>\n<pre><code># sudo yum install -y yum-utils device-mapper-persistent-data lvm2\n# sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre>\n<ol start=\"2\">\n<li>INSTALL DOCKER ENGINE - COMMUNITY</li>\n</ol>\n<pre><code># sudo yum install docker-ce docker-ce-cli containerd.io\n</code></pre>\n<ol start=\"3\">\n<li>Start Docker</li>\n</ol>\n<pre><code>$ sudo systemctl start docker\n</code></pre>\n<ol start=\"4\">\n<li>Verify that Docker Engine - Community is installed correctly by running the hello-world image.</li>\n</ol>\n<pre><code>$ sudo docker run hello-world\n</code></pre>\n<ol start=\"5\">\n<li>Verify that Docker Engine - Community is installed correctly by running the whalesay image. (Optional)</li>\n<li><a href=\"https://hub.docker.com/r/docker/whalesay\">docker/whalesa</a></li>\n</ol>\n<pre><code>$ docker run docker/whalesay cowsay boo\n</code></pre>\n<h2>使用中国区官方镜像</h2>\n<ol>\n<li>create json file</li>\n</ol>\n<pre><code># vi /etc/docker/daemon.json\n# cat /etc/docker/daemon.json\n</code></pre>\n<blockquote>\n<p>daemon.json</p>\n</blockquote>\n<pre><code>{\n  \"registry-mirrors\": [\"https://registry.docker-cn.com\"]\n}\n</code></pre>\n<ol start=\"2\">\n<li>restart docker</li>\n</ol>\n<pre><code># systemctl daemon-reload\n# systemctl restart docker\n# systemctl restart docker.service\n</code></pre>\n<ol start=\"3\">\n<li>reboot server</li>\n</ol>\n<pre><code># reboot\n</code></pre>\n<h2>Docker Compose</h2>\n<ol>\n<li>Download Docker Compose (with Daocloud Mirror)</li>\n</ol>\n<pre><code># curl -L https://get.daocloud.io/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n</code></pre>\n<ol>\n<li>Apply executable permissions to the binary:</li>\n</ol>\n<pre><code># chmod +x /usr/local/bin/docker-compose\n</code></pre>\n<ol>\n<li>Verify that Docker Compose</li>\n</ol>\n<pre><code># docker-compose --version\n</code></pre>\n<h2>基本命令</h2>\n<h3>run - Run a container</h3>\n<ul>\n<li>tag</li>\n</ul>\n<pre><code># docker run redis:4.0\n</code></pre>\n<ul>\n<li>STDIN</li>\n<li>-it (interactive mode, attach terminal)</li>\n<li>attach / detach (-d)</li>\n<li>Port Mapping (external:internal)</li>\n</ul>\n<pre><code># docker run -p 8001:3000 xxxxx\n# docker run -p 8002:3000 xxxxx\n# docker run -p 8003:3000 xxxxx\n# docker run -p 8004:3000 xxxxx\n</code></pre>\n<ul>\n<li>Volume Mapping</li>\n</ul>\n<pre><code># docker run --name db_pg_1 -v /my/own/datadir:/var/lib/postgresql/data -d postgres\n</code></pre>\n<ul>\n<li>Environment Variables</li>\n</ul>\n<pre><code># docker run -e APP_COLOR=blue XXXX\n</code></pre>\n<h3>ps - List containers</h3>\n<h3>stop - Stop a container</h3>\n<h3>rm - Remove a container</h3>\n<h3>rmi - Remove images</h3>\n<h3>pull - Download an image</h3>\n<h3>exec - Execute a command</h3>\n<h3>attach - attach a container</h3>\n<h3>inspect - inspect a container</h3>\n<h3>logs - show container's log</h3>\n<h3>示例</h3>\n<pre><code># docker run centos\n# docker run -it centos bash\n# docker ps\n# docker ps -a\n# docker run centos sleep 20\n# docker run -d --name thistest centos sleep 100\n# docker exec thistest cat /etc/*release*\n# docker stop thistest\n# docker rm xxx xxx xxx\n# docker images\n# docker rmi xxxx\n# docker pull centos\n# docker inspect thistest\n# docker logs thistest\n</code></pre>\n<h2>典型镜像</h2>\n<h3>使用 Node:alpine 启动 js 脚本</h3>\n<pre><code># docker run -it --rm --name node_main_1 -v \"$PWD\":/usr/src/app -w /usr/src/app node:11.10.1-alpine node index.js\n</code></pre>\n<h3>使用 postgres:alpine 管理数据库</h3>\n<ol>\n<li>下载镜像</li>\n</ol>\n<pre><code># docker pull postgres:alpine\n</code></pre>\n<ol>\n<li>启动容器</li>\n</ol>\n<pre><code># docker run --name dbpg -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d postgres:alpine\n</code></pre>\n<ol>\n<li>进入容器</li>\n</ol>\n<pre><code># docker exec -it dbpg /bin/bash\n</code></pre>\n<ol>\n<li>启动 psql </li>\n</ol>\n<pre><code>psql -U postgres -d postgres\n</code></pre>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://kodekloud.com/courses/296044\">Docker for the Absolute Beginner - Hands On</a></li>\n<li><a href=\"https://docs.docker.com/\">Docker Documents</a></li>\n<li><a href=\"https://www.jianshu.com/p/9ab7b89637e7\">docker实现postgresql</a></li>\n<li><a href=\"https://www.cnblogs.com/whych/p/9595671.html\">Docker网络和容器的通信</a></li>\n<li><a href=\"https://blog.csdn.net/u013355826/article/details/84987233\">docker中容器之间通信方式</a></li>\n<li><a href=\"https://www.cnblogs.com/neptunemoon/p/6512121.html#toc_30\">使用docker-compose 大杀器来部署服务</a></li>\n</ul>\n<h2>集成环境</h2>\n<h3>下载 Node 镜像</h3>\n<pre><code># docker pull node:12.14.0-alpine\n</code></pre>\n<h3>安装 Nodejs</h3>\n<ol>\n<li>download and install npm binary pakage</li>\n</ol>\n<pre><code>[root@ ~]# wget https://nodejs.org/dist/v12.14.0/node-v12.14.0-linux-x64.tar.xz\n[root@ ~]# tar -xvf node-v12.14.0-linux-x64.tar.xz\n[root@ ~]# ln -s ~/node-v12.14.0-linux-x64/bin/node /usr/bin/node\n[root@ ~]# ln -s ~/node-v12.14.0-linux-x64/bin/npm /usr/bin/npm\n[root@ ~]# npm -v\n[root@ ~]# node -v\n</code></pre>\n<p>可以使用国内镜像</p>\n<pre><code>[root@ ~]# wget https://npm.taobao.org/mirrors/node/v12.14.0/node-v12.14.0-linux-x64.tar.gz\n</code></pre>\n<blockquote>\n<p>install wget in case it is not installed</p>\n</blockquote>\n<pre><code>[root@ ~]# yum -y install wget\n</code></pre>\n<ol start=\"2\">\n<li>edit profile</li>\n</ol>\n<pre><code>[root@ ~]# vim /etc/profile\n[root@ ~]# cat /etc/profile\n</code></pre>\n<blockquote>\n<p>profile file content</p>\n</blockquote>\n<pre><code>export NODE_PATH=\"/root/node-v12.14.0-linux-x64\"\nexport PATH=$NODE_PATH/bin:$PATH\n</code></pre>\n<ol start=\"3\">\n<li>restart the server from console</li>\n</ol>\n<pre><code>[root@ ~]# reboot\n</code></pre>\n<ol start=\"4\">\n<li>install global npm packages</li>\n</ol>\n<pre><code>[root@ ~]# npm install -g yarn\n</code></pre>\n<pre><code>[root@ ~]# npm install -g gulp\n[root@ ~]# npm install -g cross-env\n[root@ ~]# npm install -g rimraf\n</code></pre>\n<p>可以使用淘宝镜像</p>\n<pre><code>npm install xxxx -g --registry=http://registry.npm.taobao.org\n</code></pre>"}},"staticQueryHashes":["2561680736","2718502863","3159585216"]}