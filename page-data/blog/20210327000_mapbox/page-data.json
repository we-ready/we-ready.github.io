{
    "componentChunkName": "component---src-templates-blog-js",
    "path": "/blog/20210327000_mapbox",
    "result": {"pageContext":{"frontmatter":{"id":"20210327000_mapbox","title":"使用 Mapbox 的地图功能","subtitle":"基于地理位置的功能越来越成为一个应用的常规功能，利用 Mapbox 可以快速快速引入地图、定位、等一系列地理位置相关的功能","subject":"LBS","authors":"Chris Wei","keywords":"Mapbox","tags":null,"category":"精选推荐","cover":"https://cdn.pixabay.com/photo/2012/06/19/10/32/owl-50267_960_720.jpg","videos":null,"created_when":"2021-03-27T00:00:00.000Z","updated_when":"2021-03-27T00:00:00.000Z","level":100},"excerpt":"# 使用 Mapbox 的地图功能\n\n# 参考\n\n*   [Web Dev Simplified]()\n\n*   [Rusty Zone]()\n","html":"<h1>使用 Mapbox 的地图功能</h1>\n<h2>参考</h2>\n<ul>\n<li><a href=\"watch?v=OySigNMXOZU\">Web Dev Simplified</a></li>\n<li><a href=\"watch?v=pL7_hCbwTHo\">Rusty Zone</a></li>\n</ul>\n<h2>注册</h2>\n<h4>注册账号</h4>\n<p><a href=\"https://www.mapbox.com/\">Mapbox</a></p>\n<h4>认证邮箱</h4>\n<blockquote>\n<p>只有完成邮箱认证，才能进入下一步</p>\n</blockquote>\n<h4>获取 Public Key</h4>\n<blockquote>\n<p>个人中心的首页，可以看到 <code>Default Public Token</code></p>\n</blockquote>\n<h2>使用</h2>\n<blockquote>\n<p>个人中心的首页，有不同的入口：<code>Web</code>、<code>iOS</code>、<code>Android</code>、等等，从 <code>Web</code> 进入，按引导开始</p>\n</blockquote>\n<h4>选择 CDN 模式</h4>\n<h4>引入脚本和样式文件</h4>\n<blockquote>\n<p>引入 <code>index.html</code></p>\n</blockquote>\n<h4>相关页面、组件增加一个地图容器</h4>\n<pre><code>&#x3C;MapArea>\n  &#x3C;div id='map' style={{width: '100%', height: '100%'}} >&#x3C;/div>\n&#x3C;/MapArea>\n</code></pre>\n<blockquote>\n<p>这里，容器的 <code>id</code> 是 <code>map</code></p>\n</blockquote>\n<h4>绘制地图</h4>\n<pre><code>  const mapboxgl  : any = window.mapboxgl;\n  mapboxgl.accessToken = CREDENTIAL.MAPBOX.PUBLIC_KEY;\n\n  const map = new mapboxgl.Map({\n    container: 'map',\n    style: 'mapbox://styles/mapbox/streets-v11',\n    center: [0, 0],\n    zoom: !center ? 9 : 14,\n  });\n</code></pre>\n<h4>获取当前位置</h4>\n<pre><code>export default function ShareLocation () {\n\n  const mapboxgl  : any = window.mapboxgl;\n  const navigator : any = window.navigator;\n  mapboxgl.accessToken = CREDENTIAL.MAPBOX.PUBLIC_KEY;\n\n  const drawMap = (center = null) => {\n    const map = new mapboxgl.Map({\n      container: 'map',\n      style: 'mapbox://styles/mapbox/streets-v11',\n      center: center || [174.763336, -36.848461],\n      zoom: !center ? 9 : 14,\n    });\n  }\n  const onSuccess = (position) => {\n    drawMap([position.coords.longitude, position.coords.latitude])\n  }\n  const onError = () => {\n    drawMap()\n  }\n  const toLocateCurrentPosition = () => {\n    navigator.geolocation.getCurrentPosition(\n      onSuccess,\n      onError,\n      {\n        enableHighAccuracy: true\n      }\n    )\n  }\n\n  useEffect (() => {\n    toLocateCurrentPosition();\n  }, []);\n\n</code></pre>\n<blockquote>\n<p>获取当前位置，浏览器会征求用户授权，如果用户授权，并成功得到了当前位置，<code>onSuccess</code> 回调函数会被执行，否则，<code>onError</code> 回调函数会被执行。</p>\n</blockquote>\n<h2>特殊说明</h2>\n<h4>声明全局 <code>Window</code> 接口</h4>\n<p>因为是通过 <code>CDN</code> 方式引入的 <code>js lib</code>，引入的 <code>lib</code> 库会挂在全局变量 <code>window</code> 下面。\n如果项目代码是基于 <code>Typescript</code>，在使用前，需要做一个全局声明，才能够访问到 <code>window.mapboxgl</code>。</p>\n<pre><code>declare global {\n  interface Window {\n    mapboxgl  : any;\n    // navigator : any;\n  }\n}\n</code></pre>\n<h4>地理位置经纬度</h4>\n<p>可以通过网站 <a href=\"https://www.latlong.net/\">latlong</a> 获取全球各地的经纬度。</p>\n<h4>开发调试时手动设置当前位置</h4>\n<p>开发调试时，如果需要浏览器返回给 <code>web app</code> 不同的地理位置信息，如果是 <code>chrome</code> 浏览器，可以通过打开 开发工具中的 <code>Sensors</code> 面板来实现。</p>"}},
    "staticQueryHashes": ["2877226700","3159585216","3659731985","3670619862"]}