{"componentChunkName":"component---src-templates-blog-js","path":"/blog/20210206101_redisearch","result":{"pageContext":{"frontmatter":{"id":"20210206101_redisearch","title":"redisearch 101","subtitle":"å…¨æ–‡æœç´¢åœ¨å„ç§ web åº”ç”¨ä¸­ï¼Œé€æ¸æˆä¸ºæ ‡é…ã€‚åº”å¯¹å¤§å‹ç³»ç»Ÿï¼ŒES ä¹Ÿè®¸æ›´åŠ é€‚åˆï¼Œè€Œé¢å¯¹ä¸­å°å‹é¡¹ç›®ï¼Œredisearchä¹Ÿè®¸æ˜¯ä¸€ç§æ›´åŠ é€‚åˆçš„æ–¹æ¡ˆã€‚","subject":"redisearch","author":"Chis Wei","keywords":"å…¨æ–‡æœç´¢;è‡ªåŠ¨è¡¥å…¨;åå‘ç´¢å¼•","tags":"redis;redislabs;redisearch","category":"æ¦‚å¿µç†è§£","cover":"https://oss.redislabs.com/redisearch/img/logo.svg","created_when":"2021-02-06","updated_when":"2021-02-06","level":100},"excerpt":" redisearch 101\n\n å‚è€ƒ\n\n-   [gitee mirror of redâ€¦](<>)\n","html":"<h1>redisearch 101</h1>\n<h2>å‚è€ƒ</h2>\n<ul>\n<li><a href=\"https://gitee.com/mirrors/redisearch\">gitee mirror of redisearch repo</a></li>\n<li><a href=\"https://github.com/RediSearch/redisearch-getting-started\">getting started</a></li>\n<li><a href=\"https://oss.redislabs.com/redisearch/\">redislabs</a></li>\n<li><a href=\"https://university.redislabs.com/courses/ru201/\">RU201: RediSearch</a></li>\n<li><a href=\"https://github.com/redislabs-training/ru203/blob/main/README.md\">course material</a></li>\n</ul>\n<h2>RU201: RediSearch</h2>\n<blockquote>\n<p>å¯ä»¥åœ¨ <code>redislabs university</code> æ³¨å†Œå¹¶å®Œæˆç›¸å…³è¯¾ç¨‹</p>\n</blockquote>\n<h3>Set Up RediSearch and Loading the Data ï¼ˆæœ¬åœ°ç¯å¢ƒï¼‰</h3>\n<ol>\n<li>å¯åŠ¨è£…æœ‰ <code>docker compose</code> çš„ <code>VMWare CentOS</code> æœåŠ¡å™¨</li>\n<li>é€šè¿‡ <code>XShell</code> è¿æ¥æœåŠ¡å™¨</li>\n<li>å¯åŠ¨ <code>redis</code> å®ä¾‹ï¼ˆæœåŠ¡å™¨ä¸Šä¹‹å‰æ²¡æœ‰ç›¸å…³é•œåƒï¼Œå¯åŠ¨è¿‡ç¨‹ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…ï¼Œå®‰è£…éœ€è¦ä¸€äº›æ—¶é—´ã€‚ï¼‰</li>\n</ol>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<pre><code>docker run -it --rm --name redis-search-2 -p 6379:6379  redislabs/redisearch:2.0.5\n</code></pre>\n<ol start=\"4\">\n<li>ä»ä»£ç åº“ä¸‹è½½è¯•éªŒæ•°æ® <code>commands.redis</code>ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</li>\n</ol>\n<pre><code># rz\n</code></pre>\n<ol start=\"5\">\n<li>åŠ è½½è¯•éªŒæ•°æ®</li>\n</ol>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<pre><code>docker exec -i redis-search-2 redis-cli &#x3C; commands.redis > output.txt\n</code></pre>\n<ol start=\"6\">\n<li>æ£€æŸ¥ <code>output.txt</code></li>\n</ol>\n<pre><code>grep Invalid output.txt\n</code></pre>\n<blockquote>\n<p>ç¡®ä¿æ²¡æœ‰ä»»ä½• <code>invalid</code> æ•°æ®ã€‚ï¼ˆå¦åˆ™ï¼Œè¯´æ˜ç¯å¢ƒæ²¡æœ‰æ­£ç¡®å®‰è£…ï¼‰</p>\n</blockquote>\n<h3>æŸ¥è¯¢ç»“æ„åŒ–æ•°æ®</h3>\n<h4>åŸºæœ¬è¯­æ³•</h4>\n<pre><code>@[field]:{[keyword]}\n</code></pre>\n<h4>è½¬è¯‘å­—ç¬¦</h4>\n<pre><code>\\\\\n</code></pre>\n<h4>ç»ƒä¹ </h4>\n<ul>\n<li>è¿æ¥ <code>docker</code></li>\n</ul>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<pre><code>docker exec -it redis-search-2 redis-cli\n</code></pre>\n<ul>\n<li>åˆ›å»ºç´¢å¼•</li>\n</ul>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<pre><code>FT.CREATE books-idx ON HASH PREFIX 1 ru203:book:details: SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR \";\" author_ids TAG SEPARATOR \";\"\n\nFT.CREATE users-idx ON HASH PREFIX 1 ru203:user:details: SCHEMA first_name TEXT SORTABLE last_name TEXT SORTABLE email TAG SORTABLE escaped_email TEXT NOSTEM SORTABLE user_id TAG SORTABLE last_login NUMERIC SORTABLE\n\nFT.CREATE authors-idx ON HASH PREFIX 1 ru203:author:details: SCHEMA name TEXT SORTABLE author_id TAG SORTABLE\n\nFT.CREATE authors-books-idx ON HASH PREFIX 1 ru203:author:books: SCHEMA book_isbn TAG SORTABLE author_id TAG SORTABLE\n\nFT.CREATE checkouts-idx ON HASH PREFIX 1 ru203:book:checkout: SCHEMA user_id TAG SORTABLE book_isbn TAG SORTABLE checkout_date NUMERIC SORTABLE return_date NUMERIC SORTABLE checkout_period_days NUMERIC SORTABLE geopoint GEO\n</code></pre>\n<blockquote>\n<p>æ¯æ¬¡é€€å‡º dockerï¼Œç›¸å…³å‘½ä»¤éœ€è¦é‡æ–°æ‰§è¡Œ</p>\n</blockquote>\n<ul>\n<li>æŸ¥æ‰¾æ•°æ®ï¼ˆ<code>String</code>ç±»å‹ï¼‰</li>\n</ul>\n<pre><code>FT.SEARCH books-idx \"@isbn:{9781577312093}\"\n\nFT.SEARCH authors-idx \"@author_id:{690}\"\n\nFT.SEARCH books-idx \"@author_ids:{690}\" RETURN 1 title\n\nFT.SEARCH books-idx \"@categories:{Fantasy}\"\n</code></pre>\n<blockquote>\n<p>å¯¹äºå­—ç¬¦ä¸²æŸ¥è¯¢ï¼Œæœ€æœ‰æ•ˆçš„æ•°æ®ç±»å‹æ˜¯ <code>TAG</code></p>\n</blockquote>\n<ul>\n<li>æŸ¥æ‰¾æ•°æ®ï¼ˆ<code>Number</code>ç±»å‹ï¼‰</li>\n</ul>\n<pre><code>FT.SEARCH books-idx \"@average_rating:[4.5 5]\" RETURN 1 title\n\nFT.SEARCH books-idx \"@average_rating:[0 1]\" RETURN 1 title\n\nFT.SEARCH books-idx \"@average_rating:[4 +inf] @published_year:[2015 +inf]\" RETURN 1 title\n\nFT.SEARCH books-idx \"@average_rating:[-inf 3] @published_year:[-inf (2000]\" RETURN 1 title\n</code></pre>\n<blockquote>\n<p><code>inf</code> è¡¨ç¤ºæ— ç©·</p>\n</blockquote>\n<blockquote>\n<p><code>)(</code> è¡¨ç¤ºä¸åŒ…å«ï¼ˆç¼ºçœæŸ¥è¯¢èŒƒå›´ï¼Œä¼šåŒ…å«ä¸¤ç«¯ï¼‰</p>\n</blockquote>\n<ul>\n<li>æŸ¥æ‰¾æ•°æ®ï¼ˆ<code>Date</code> <code>Time</code> ç±»å‹ï¼‰</li>\n</ul>\n<pre><code>FT.SEARCH users-idx \"@last_login:[1607693100 +inf]\"\n\nFT.SEARCH users-idx \"@last_login:[-inf (1607693100]\"\n</code></pre>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<blockquote>\n<p><a href=\"http://www.unixtimestampconverter.com/\">A simple converter tool for Unix Timestamps</a></p>\n</blockquote>\n<ul>\n<li>æŸ¥æ‰¾æ•°æ®ï¼ˆ<code>Boolean Logic</code> ç±»å‹ï¼‰</li>\n</ul>\n<pre><code>FT.SEARCH books-idx \"dogs cats\"\n\nFT.SEARCH books-idx \"dogs|cats\"\n\nFT.SEARCH books-idx \"dogs -cats\"\n</code></pre>\n<blockquote>\n<p><code>ä¸</code> <code>æˆ–</code> <code>é</code></p>\n</blockquote>\n<pre><code>FT.SEARCH books-idx \"@title:Meridian | Orchard\"\n\nFT.SEARCH books-idx \"@authors:rowling @title:goblet\"\n\nFT.SEARCH books-idx \"@authors:rowling | @title:potter\"\n\nFT.SEARCH books-idx \"@authors:tolkien -@title:ring\"\n</code></pre>\n<pre><code>FT.SEARCH books-idx \"@authors:'Stephen King' @published_year:[1980 1990]\"\n\nFT.SEARCH books-idx \"@categories:{Philosophy} @published_year:[-inf 1975] -@authors:'Arthur Koestler'\"\n\nFT.SEARCH books-idx \"@authors:'Arthur Koestler' | @authors:'Michel Foucault'\"\n</code></pre>\n<ul>\n<li>æŸ¥è¯¢ç»“æœæ’åºï¼ˆ<code>Sorting</code>ï¼‰</li>\n</ul>\n<blockquote>\n<p>ç›¸å…³å­—æ®µå¿…é¡»æ˜¯ <code>SORTABLE</code> çš„</p>\n</blockquote>\n<blockquote>\n<p>ä½¿ç”¨ <code>aggregation</code> ç‰¹æ€§çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€æ¬¡æœç´¢ä¸­å¯¹å¤šä¸ªå­—æ®µè¿›è¡Œæ’åº</p>\n</blockquote>\n<pre><code>FT.SEARCH books-idx \"@published_year:[2018 +inf]\" SORTBY published_year DESC\n\nFT.SEARCH books-idx \"@categories:{Juvenile Fiction}\" SORTBY published_year\n\nFT.SEARCH books-idx \"@average_rating:[4.9 5]\" SORTBY average_rating DESC\n</code></pre>\n<ul>\n<li>æŸ¥è¯¢ç»“æœæ•°é‡é™åˆ¶ï¼ˆ<code>Limiting</code>ï¼‰</li>\n</ul>\n<blockquote>\n<p>2 ä¸ªå‚æ•°ï¼š<code>offset</code> <code>limit</code></p>\n</blockquote>\n<blockquote>\n<p><code>offset</code> æ˜¯ <code>0</code> å¼€å§‹çš„</p>\n</blockquote>\n<pre><code>FT.SEARCH books-idx \"@authors:Agatha Christie\" SORTBY published_year LIMIT 0 5\n\nFT.SEARCH books-idx \"@authors:Agatha Christie\" SORTBY published_year LIMIT 5 5\n\nFT.SEARCH books-idx \"@authors:Ursula K. Le Guin\" SORTBY \"published_year\" LIMIT 0 3\n\nFT.SEARCH books-idx \"@published_year:[2000 +inf]\" LIMIT 100 100\n</code></pre>\n<h3>å…¨æ–‡æœç´¢</h3>\n<h4>æ¦‚å¿µ</h4>\n<ul>\n<li>æœç´¢ <code>TEXT</code> ç±»å‹å­—æ®µ</li>\n<li><code>stemming</code>: <code>TEXT</code> ç±»å‹å­—æ®µè¢«ç´¢å¼•æ—¶ï¼Œå•è¯ä¼šè¢«è½¬åŒ–ä¸ºè¯æ ¹</li>\n</ul>\n<h4>ç»ƒä¹ </h4>\n<pre><code>FT.SEARCH books-idx \"@title:running\" RETURN 1 title\n\nFT.SEARCH books-idx \"John Le Carre\"\n\nFT.SEARCH books-idx unicorns\n</code></pre>\n<h4>æ¨¡ç³ŠæŸ¥è¯¢ ï¼ˆ<code>prefix matching</code>ï¼‰</h4>\n<blockquote>\n<p>æ¨¡ç³ŠæŸ¥è¯¢ä¼šæ¶ˆè€—æ€§èƒ½</p>\n</blockquote>\n<pre><code>FT.SEARCH books-idx \"atwood hand*\"\n\nFT.SEARCH books-idx \"agat* orie*\"\n</code></pre>\n<h4>é€»è¾‘ã€æ’åºã€é™åˆ¶</h4>\n<pre><code>FT.SEARCH books-idx \"dragons -wizard -magician\"\n\nFT.SEARCH books-idx \"mars @authors:heinlein\"\n\nFT.SEARCH books-idx crypto* sortby published_year\n\nFT.SEARCH books-idx murder sortby published_year limit 0 1\n</code></pre>\n<h4>é«˜äº® æ¦‚è¦</h4>\n<pre><code>FT.SEARCH books-idx illusion highlight\n\nFT.SEARCH books-idx \"nurture\" HIGHLIGHT FIELDS 2 title subtitle\n\nFT.SEARCH books-idx shield HIGHLIGHT SUMMARIZE FIELDS 1 description FRAGS 1 LEN 20\n\nFT.SEARCH books-idx agamemnon SUMMARIZE FIELDS 1 description FRAGS 3 LEN 25\n\nFT.SEARCH books-idx agamemnon SUMMARIZE FIELDS 1 description FRAGS 3 LEN 25 HIGHLIGHT\n</code></pre>\n<h3>èšåˆï¼ˆaggregationï¼‰</h3>\n<h4>ç»Ÿè®¡ï¼ˆcountingï¼‰</h4>\n<pre><code>FT.AGGREGATE books-idx * GROUPBY 0 REDUCE COUNT 0 AS total\n\nFT.SEARCH books-idx \"@categories:{Fiction}\" LIMIT 0 0\n</code></pre>\n<h4>åˆ†ç»„ï¼ˆgroupingï¼‰</h4>\n<pre><code>FT.AGGREGATE books-idx tolkien GROUPBY 0\n\nFT.AGGREGATE checkouts-idx * GROUPBY 1 @checkout_date\n\nFT.AGGREGATE books-idx python GROUPBY 1 @categories\n\nFT.AGGREGATE books-idx marauder GROUPBY 2 @published_year @average_rating\n</code></pre>\n<h4>æ’åºï¼ˆsortingï¼‰</h4>\n<pre><code>FT.AGGREGATE users-idx * GROUPBY 2 @last_login @last_name SORTBY 1 @last_name\n\nFT.AGGREGATE books-idx \"@published_year:[1983 1983]\" GROUPBY 2 @authors @title SORTBY 2 @authors @title\n</code></pre>\n<h4>èšåˆï¼ˆreducingï¼‰</h4>\n<pre><code>FT.AGGREGATE books-idx * GROUPBY 1 @categories REDUCE COUNT 0 AS books_count SORTBY 2 @books_count DESC\n\nFT.AGGREGATE books-idx tolkien GROUPBY 0 REDUCE AVG 1 @average_rating as avg_rating\n</code></pre>\n<p>âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’</p>\n<blockquote>\n<p><a href=\"https://oss.redislabs.com/redisearch/Aggregations/#supported_groupby_reducers\">Ref</a></p>\n</blockquote>\n<h4>å˜æ¢ï¼ˆtransformingï¼‰</h4>\n<pre><code>FT.AGGREGATE books-idx * APPLY \"split(@authors, ';')\" AS authors_split GROUPBY 1 @title REDUCE COUNT 1 authors_split AS num_authors FILTER \"@num_authors==2\"\n\nFT.AGGREGATE users-idx * GROUPBY 1 @last_login APPLY \"dayofweek(@last_login)\" AS day_of_week GROUPBY 1 @day_of_week SORTBY 1 @day_of_week\n\nFT.AGGREGATE users-idx * GROUPBY 2 @last_login @user_id APPLY \"day(@last_login)\" as last_login_day APPLY \"timefmt(@last_login_day)\" AS \"last_login_str\" GROUPBY 1 \"@last_login_str\" REDUCE COUNT_DISTINCT 1 \"@user_id\" AS num_logins FILTER \"@num_logins>1\"\n</code></pre>\n<h3>è¿›é˜¶åŠŸèƒ½</h3>\n<h4>Patial Index</h4>\n<pre><code>FT.CREATE books-older-idx ON HASH PREFIX 1 ru203:book:details: FILTER \"@published_year&#x3C;1990\" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR \";\" author_ids TAG SEPARATOR \";\"\n\nFT.CREATE books-newer-idx ON HASH PREFIX 1 ru203:book:details: FILTER \"@published_year>=1990\" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR \";\" author_ids TAG SEPARATOR \";\"\n</code></pre>\n<pre><code>FT.SEARCH books-older-idx * LIMIT 0 0\n\nFT.SEARCH books-newer-idx * LIMIT 0 0\n</code></pre>\n<pre><code>FT.CREATE books-fiction-idx ON HASH PREFIX 1 ru203:book:details: FILTER \"@categories=='Fiction'\" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR \";\" author_ids TAG SEPARATOR \";\"\n\nFT.AGGREGATE books-fiction-idx * GROUPBY 1 @authors REDUCE COUNT_DISTINCT 1 @title as total_books SORTBY 2 @total_books DESC\n</code></pre>\n<h4>WEIGHT (æƒé‡)</h4>\n<pre><code>FT.SEARCH books-idx \"((@categories:{History}) => { $weight: 10 } greek) | greek\"\n\nFT.SEARCH books-idx \"((@published_year:[2000 +inf]) => { $weight: 10 } cowboy) | cowboy\"\n</code></pre>\n<h4>Getting All</h4>\n<pre><code>FT.SEARCH users-idx *\n</code></pre>\n<blockquote>\n<p><code>*</code></p>\n</blockquote>\n<h4>Exact-Matching Punctuation (ç²¾ç¡®åŒ¹é…)</h4>\n<pre><code>HMSET ru203:user:details:28 first_name \"Kelvin\" last_name \"Brown\" email \"k.brown@example.com\" escaped_email \"k\\\\.brown\\\\@example\\\\.com\" user_id \"28\"\n\nFT.SEARCH users-idx \"@escaped_email:k\\\\.brown\\\\@example\\\\.com\"\n</code></pre>\n<pre><code>HMSET ru203:user:details:1000 first_name \"Andrew\" last_name \"Brookins\" escaped_email \"a\\\\.m\\\\.brookins\\\\@example\\\\.com\" user_id \"1000\"\n\nFT.SEARCH users-idx \"@escaped_email:a\\\\.m\\\\.brookins\\\\@example\\\\.com\"\n</code></pre>\n<h4>Handling Spelling Errors ï¼ˆå¤„ç†æ‹¼å†™é”™è¯¯ï¼‰</h4>\n<blockquote>\n<p>å¦‚æœç¬¬ä¸€æ¬¡æœç´¢ç»“æœæ˜¯ <code>0</code>ï¼Œå¯ä»¥å°è¯• <code>FT.SPELLCHECK</code> å¯¹æœç´¢å…³é”®è¯åšæ‹¼å†™æ£€æŸ¥</p>\n</blockquote>\n<pre><code>FT.SPELLCHECK books-idx wizrds\n</code></pre>\n<pre><code>FT.SPELLCHECK books-idx monter\n\nFT.SEARCH books-idx \"%monter%\"\n</code></pre>\n<h3>Data Model</h3>\n<pre><code>    Authors\n+--------------+\n|  name        |               Author-Books\n|              |            +----------------+\n|  author_id   +------------+  author_id     |\n|              |            |                |\n+--------------+        +---+  book_isbn     |\n                        |   |                |\n    Users               |   +----------------+\n+--------------+        |\n|  first_name  |        |\n|              |        |\n|  last_name   |        |       Checkouts\n|              |        |  +------------------------+\n|  email       |   +----|--+  user_id               |\n|              |   |    |  |                        |\n|  user_id     +---+    +--+  book_isbn             |\n|              |        |  |                        |\n|  last_login  |        |  |  checkout_date         |\n|              |        |  |                        |\n+--------------+        |  |  checkout_length_days  |\n                        |  |                        |\n    Books               |  |  geopoint              |\n+--------------+        |  |                        |\n|  isbn        +--------+  +------------------------+\n|              |\n|  title       |\n|              |\n|  subtitle    |\n|              |\n|  thumbnail   |\n|              |\n|  description |\n|              |\n|  categories  |\n|              |\n|  authors     |\n|              |\n|  author_ids  |\n|              |\n+--------------+\n</code></pre>"}},"staticQueryHashes":["2718502863","3159585216","847266990"]}