<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.13.1"/><style data-styled="" data-styled-version="5.3.3">.iBUILR{width:auto;height:100%;padding:0 1em 0 .5em;margin:0;gap:normal;font-size:inherit;color:inherit;background:transparent;border-radius:9px;}/*!sc*/
.bihRCo{width:auto;height:auto;padding:0;margin:0;gap:normal;font-size:inherit;color:inherit;background:transparent;border-radius:9px;}/*!sc*/
.ebstCf{width:auto;height:auto;padding:0;margin:1rem 0;gap:normal;font-size:inherit;color:inherit;background:transparent;border-radius:9px;}/*!sc*/
.jrwTuf{width:auto;height:auto;padding:0;margin:1rem 0 0 0;gap:normal;font-size:inherit;color:inherit;background:transparent;border-radius:9px;}/*!sc*/
data-styled.g1[id="Common__Container-sc-qqf9b1-0"]{content:"iBUILR,bihRCo,ebstCf,jrwTuf,"}/*!sc*/
.feDaHt{display:inline-block;vertical-align:middle;-webkit-flex:0 0 content;-ms-flex:0 0 content;flex:0 0 content;margin:0;padding:0;background:transparent;color:#fff;border:none;border-radius:100%;cursor:auto;height:auto;overflow:hidden;}/*!sc*/
.feDaHt svg{width:36px;fill:none;-webkit-animation:none 1s infinite linear;animation:none 1s infinite linear;}/*!sc*/
data-styled.g2[id="common__SVGContainer-sc-5wxmvs-0"]{content:"feDaHt,"}/*!sc*/
.jaxOUy{display:inline-block;padding:.25em .8rem;border-radius:.8em;border:1px solid var(--ant-color-purple-border);background:var(--ant-color-purple-bg);color:var(--ant-color-purple);}/*!sc*/
data-styled.g3[id="Tag-sc-u31xqs-0"]{content:"jaxOUy,"}/*!sc*/
.gttqhR{-webkit-text-decoration:none;text-decoration:none;color:#177CB0;}/*!sc*/
data-styled.g6[id="Link__Container-sc-zcsev2-0"]{content:"gttqhR,"}/*!sc*/
.eNGrUK{background:transparent;max-width:1080px;margin:0 auto;}/*!sc*/
data-styled.g21[id="Layout__CenterContainer-sc-1bdq7wd-0"]{content:"eNGrUK,"}/*!sc*/
.cRFnth{width:auto;height:4rem;padding:0 24px;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:#276893;}/*!sc*/
.dvhtpb{width:auto;height:4rem;padding:0;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:#276893;}/*!sc*/
.eJzqUT{width:auto;height:auto;padding:.5rem;margin:0;gap:normal;font-size:inherit;color:inherit;background:rgba(62,60,61,0.1);}/*!sc*/
.eGASSl{width:auto;height:auto;padding:1.2rem 0;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:#3E3C3D;}/*!sc*/
data-styled.g24[id="Layout__Section-sc-1bdq7wd-3"]{content:"cRFnth,dvhtpb,eJzqUT,eGASSl,"}/*!sc*/
.hmfyXj{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;max-width:100%;min-height:100%;}/*!sc*/
.hmfyXj code{color:#F3F9F1;background:rgba(62,60,61,0.6);}/*!sc*/
.hmfyXj pre{margin:1rem 0;padding:3rem 1rem 1rem;overflow-x:auto;color:#F3F9F1;background:rgba(62,60,61,1.0);border-radius:6px 6px 0 0;position:relative;}/*!sc*/
.hmfyXj pre:before{content:' ğŸŸ  ğŸŸ¡ ğŸŸ¢';position:absolute;top:0;left:0;width:100%;height:2rem;line-height:2rem;display:block;background:#000;border-radius:6px 6px 0 0;}/*!sc*/
.hmfyXj pre code{max-width:100%;font-family:Menlo,Monaco,"Courier New",monospace;color:#fff;background:transparent;font-size:.8em;}/*!sc*/
.hmfyXj a,.hmfyXj a:visited{color:#0000ff;}/*!sc*/
.hmfyXj a:hover,.hmfyXj a:focus,.hmfyXj a:active{color:#007cff;}/*!sc*/
.hmfyXj ul{list-style:none;padding-left:0.6em;margin-left:2.0em;}/*!sc*/
.hmfyXj ul li{position:relative;}/*!sc*/
.hmfyXj ul li:before{position:absolute;left:-1.6em;content:"â–²";color:#276893;font-size:.9em;}/*!sc*/
.hmfyXj ol{margin:3em 0 1em 2.8em;font-size:10px;counter-reset:section;}/*!sc*/
.hmfyXj ol ol{margin-top:1em;list-style-type:none;}/*!sc*/
.hmfyXj ol ol ol{list-style-type:lower-alpha;padding-left:1em;margin-left:1em;}/*!sc*/
.hmfyXj ol ol ol ol{list-style-type:lower-roman;padding-left:1em;margin-left:1em;}/*!sc*/
.hmfyXj ol li{counter-increment:section;margin-top:1em;position:relative;}/*!sc*/
.hmfyXj ol li{font-weight:600;color:#276893;}/*!sc*/
.hmfyXj ol ol li{font-weight:400;color:#000;}/*!sc*/
.hmfyXj li p{font-weight:400;color:#000;}/*!sc*/
.hmfyXj ol li:before{position:absolute;left:-2.4em;content:counters(section);}/*!sc*/
.hmfyXj ol ol li:before{position:absolute;left:-2.4em;content:counters(section,".");}/*!sc*/
.hmfyXj ol ol ol li:before{content:"";}/*!sc*/
.hmfyXj.retro-no-decoration{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.hmfyXj p,.hmfyXj .retro-p{margin-bottom:.6em;}/*!sc*/
.hmfyXj h1,.hmfyXj .retro-h1,.hmfyXj h2,.hmfyXj .retro-h2,.hmfyXj h3,.hmfyXj .retro-h3,.hmfyXj h4,.hmfyXj .retro-h4{margin:1.414em 0 .5em;}/*!sc*/
.hmfyXj h1,.hmfyXj .retro-h1{display:none;width:100%;text-align:center;margin-top:0;font-size:1.8em;-webkit-letter-spacing:.16em;-moz-letter-spacing:.16em;-ms-letter-spacing:.16em;letter-spacing:.16em;}/*!sc*/
.hmfyXj h2,.hmfyXj .retro-h2{font-size:1.6em;}/*!sc*/
.hmfyXj h2::after{content:'';display:block;margin:.5rem 0 1rem;width:100%;border-bottom:1px solid rgba(62,60,61,0.3);}/*!sc*/
.hmfyXj h3,.hmfyXj .retro-h3{font-size:1.2em;}/*!sc*/
.hmfyXj h4,.hmfyXj .retro-h4{font-size:1em;}/*!sc*/
.hmfyXj h5,.hmfyXj .retro-h5{font-size:.8em;}/*!sc*/
.hmfyXj h6,.hmfyXj .retro-h6{font-size:.7em;}/*!sc*/
.hmfyXj small,.hmfyXj .retro-small{font-size:.6em;}/*!sc*/
.hmfyXj blockquote{margin:1em 0;padding-left:1em;}/*!sc*/
.hmfyXj img,.hmfyXj canvas,.hmfyXj iframe,.hmfyXj video,.hmfyXj svg,.hmfyXj select,.hmfyXj textarea{max-width:100%;}/*!sc*/
.hmfyXj table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb;}/*!sc*/
.hmfyXj thead{background-color:#666666;color:#fff;vertical-align:bottom;-webkit-letter-spacing:.2em;-moz-letter-spacing:.2em;-ms-letter-spacing:.2em;letter-spacing:.2em;}/*!sc*/
.hmfyXj td,.hmfyXj th{margin:0;padding:.5em 1em;border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;overflow:visible;}/*!sc*/
.hmfyXj tr:nth-child(2n+1){background-color:transparent;}/*!sc*/
.hmfyXj tr:nth-child(2n+0){background-color:#f9f9f9;}/*!sc*/
.hmfyXj caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center;}/*!sc*/
data-styled.g76[id="Markdownstyle__Markdown2HTMLStyle1-sc-1sf8evq-0"]{content:"hmfyXj,"}/*!sc*/
*{margin:0;padding:0;box-sizing:border-box;background:transparent;--ant-color-success:#52c41a;--ant-color-success-hover:#73d13d;--ant-color-success-active:#389e0d;--ant-color-success-outline:rgba(82,196,26,.2);--ant-color-success-deprecated-bg:#f6ffed;--ant-color-success-deprecated-border:#b7eb8f;--ant-color-error:#ff4d4f;--ant-color-error-hover:#ff7875;--ant-color-error-active:#d9363e;--ant-color-error-outline:rgba(255,77,79,.2);--ant-color-error-deprecated-bg:#fff2f0;--ant-color-error-deprecated-border:#ffccc7;--ant-color-warning:#faad14;--ant-color-warning-hover:#ffc53d;--ant-color-warning-active:#d48806;--ant-color-warning-outline:rgba(250,173,20,.2);--ant-color-warning-deprecated-bg:#fffbe6;--ant-color-warning-deprecated-border:#ffe58f;--ant-color-info:#1890ff;--ant-color-info-outline:rgba(24,144,255,.2);--ant-color-info-deprecated-bg:#e6f7ff;--ant-color-info-deprecated-border:#91d5ff;--ant-color-magenta:#c41d7f;--ant-color-magenta-bg:#fff0f6;--ant-color-magenta-border:#ffadd2;--ant-color-red:#cf1322;--ant-color-red-bg:#fff1f0;--ant-color-red-border:#ffa39e;--ant-color-volcano:#d4380d;--ant-color-volcano-bg:#fff2e8;--ant-color-volcano-border:#ffbb96;--ant-color-orange:#d46b08;--ant-color-orange-bg:#fff7e6;--ant-color-orange-border:#ffd591;--ant-color-gold:#d48806;--ant-color-gold-bg:#fffbe6;--ant-color-gold-border:#ffe58f;--ant-color-lime:#7cb305;--ant-color-lime-bg:#fcffe6;--ant-color-lime-border:#eaff8f;--ant-color-green:#389e0d;--ant-color-green-bg:#f6ffed;--ant-color-green-border:#b7eb8f;--ant-color-cyan:#08979c;--ant-color-cyan-bg:#e6fffb;--ant-color-cyan-border:#87e8de;--ant-color-blue:#096dd9;--ant-color-blue-bg:#e6f7ff;--ant-color-blue-border:#91d5ff;--ant-color-geekblue:#1d39c4;--ant-color-geekblue-bg:#f0f5ff;--ant-color-geekblue-border:#adc6ff;--ant-color-purple:#531dab;--ant-color-purple-bg:#f9f0ff;--ant-color-purple-border:#d3adf7;}/*!sc*/
* .clr-primary{color:#276893;}/*!sc*/
* .clr-secondary{color:#E47542;}/*!sc*/
* .clr-blue{color:#507883;}/*!sc*/
* .clr-yellow{color:#FFB61E;}/*!sc*/
* .clr-green{color:#006E5F;}/*!sc*/
* .clr-red{color:#C03F3C;}/*!sc*/
* .clr-white{color:#F3F9F1;}/*!sc*/
* .clr-black{color:#3E3C3D;}/*!sc*/
* .clr-gold{color:#EACD76;}/*!sc*/
* .clr-link{color:#177CB0;}/*!sc*/
* .clr-grey-1{color:hsl(0,0%,10%);}/*!sc*/
* .clr-grey-2{color:hsl(0,0%,20%);}/*!sc*/
* .clr-grey-3{color:hsl(0,0%,30%);}/*!sc*/
* .clr-grey-4{color:hsl(0,0%,40%);}/*!sc*/
* .clr-grey-5{color:hsl(0,0%,50%);}/*!sc*/
* .clr-grey-6{color:hsl(0,0%,60%);}/*!sc*/
* .clr-grey-7{color:hsl(0,0%,70%);}/*!sc*/
* .clr-grey-8{color:hsl(0,0%,80%);}/*!sc*/
* .clr-grey-9{color:hsl(0,0%,90%);}/*!sc*/
* .bg-clr-primary{background-color:#276893;}/*!sc*/
* .bg-clr-secondary{background-color:#E47542;}/*!sc*/
* .bg-clr-blue{background-color:#507883;}/*!sc*/
* .bg-clr-yellow{background-color:#FFB61E;}/*!sc*/
* .bg-clr-green{background-color:#006E5F;}/*!sc*/
* .bg-clr-red{background-color:#C03F3C;}/*!sc*/
* .bg-clr-white{background-color:#F3F9F1;}/*!sc*/
* .bg-clr-black{background-color:#3E3C3D;}/*!sc*/
* .bg-clr-gold{background-color:#EACD76;}/*!sc*/
* .bg-clr-link{background-color:#177CB0;}/*!sc*/
* .bg-clr-grey-1{background-color:hsl(0,0%,10%);}/*!sc*/
* .bg-clr-grey-2{background-color:hsl(0,0%,20%);}/*!sc*/
* .bg-clr-grey-3{background-color:hsl(0,0%,30%);}/*!sc*/
* .bg-clr-grey-4{background-color:hsl(0,0%,40%);}/*!sc*/
* .bg-clr-grey-5{background-color:hsl(0,0%,50%);}/*!sc*/
* .bg-clr-grey-6{background-color:hsl(0,0%,60%);}/*!sc*/
* .bg-clr-grey-7{background-color:hsl(0,0%,70%);}/*!sc*/
* .bg-clr-grey-8{background-color:hsl(0,0%,80%);}/*!sc*/
* .bg-clr-grey-9{background-color:hsl(0,0%,90%);}/*!sc*/
* .ft-regular{font-weight:400;}/*!sc*/
* .ft-medium{font-weight:500;}/*!sc*/
* .ft-bold{font-weight:700;}/*!sc*/
* .ft-20{font-size:2em;}/*!sc*/
* .ft-15{font-size:1.5em;}/*!sc*/
* .ft-12{font-size:1.2em;}/*!sc*/
* .ft-09{font-size:.9em;}/*!sc*/
* .ft-08{font-size:.8em;}/*!sc*/
* .ft-07{font-size:.7em;}/*!sc*/
* .ft-06{font-size:.6em;}/*!sc*/
* .word-wrap{word-wrap:break-word;}/*!sc*/
* .word-break{word-break:break-all;}/*!sc*/
* .white-space-no-wrap{white-space:nowrap;}/*!sc*/
* .white-space-pre-wrap{white-space:pre-wrap;}/*!sc*/
* .text-indent{text-indent:2em;}/*!sc*/
* .text-align-center{text-align:center;}/*!sc*/
* .text-align-right{text-align:right;}/*!sc*/
* .cursor-pointer{cursor:pointer;}/*!sc*/
* .relative-position{position:relative;}/*!sc*/
* .absolute-position{position:absolute;}/*!sc*/
* .z-level-100{z-index:100;}/*!sc*/
* .z-level-200{z-index:200;}/*!sc*/
* .z-level-500{z-index:500;}/*!sc*/
* .z-level-800{z-index:800;}/*!sc*/
* .ellipsis{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}/*!sc*/
* .ellipsis-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-word;}/*!sc*/
* .ellipsis-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-word;}/*!sc*/
* .full-size{width:100%;height:100%;}/*!sc*/
* .flex-start{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
* .flex-end{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}/*!sc*/
* .flex-between{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
* .flex-around{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;}/*!sc*/
* .flex-center{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
* .align-center{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
* .align-start{-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}/*!sc*/
* .align-end{-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;}/*!sc*/
* .align-stretch{-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}/*!sc*/
* .flex-wrap{-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}/*!sc*/
* .direction-reverse{-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;}/*!sc*/
* .direction-col{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
* .radius-025{border-radius:.25em;}/*!sc*/
* .radius-05{border-radius:.5em;}/*!sc*/
* .radius-1{border-radius:1em;}/*!sc*/
* .shadow01{box-shadow:0px 1px 1px rgba(0,0,0,0.14),0px 2px 1px rgba(0,0,0,0.12),0px 1px 3px rgba(0,0,0,0.2);}/*!sc*/
* .shadow02{box-shadow:0px 2px 2px rgba(0,0,0,0.14),0px 3px 1px rgba(0,0,0,0.12),0px 1px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow03{box-shadow:0px 3px 4px rgba(0,0,0,0.14),0px 3px 3px rgba(0,0,0,0.12),0px 1px 8px rgba(0,0,0,0.2);}/*!sc*/
* .shadow04{box-shadow:0px 4px 5px rgba(0,0,0,0.14),0px 1px 10px rgba(0,0,0,0.12),0px 2px 4px rgba(0,0,0,0.2);}/*!sc*/
* .shadow06{box-shadow:0px 6px 10px rgba(0,0,0,0.14),0px 1px 18px rgba(0,0,0,0.12),0px 3px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow08{box-shadow:0px 8px 10px rgba(0,0,0,0.14),0px 3px 14px rgba(0,0,0,0.12),0px 5px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow09{box-shadow:0px 9px 12px rgba(0,0,0,0.14),0px 3px 16px rgba(0,0,0,0.12),0px 5px 6px rgba(0,0,0,0.2);}/*!sc*/
* .shadow12{box-shadow:0px 12px 17px rgba(0,0,0,0.14),0px 5px 22px rgba(0,0,0,0.12),0px 7px 8px rgba(0,0,0,0.2);}/*!sc*/
* .shadow16{box-shadow:0px 16px 24px rgba(0,0,0,0.14),0px 6px 30px rgba(0,0,0,0.12),0px 8px 10px rgba(0,0,0,0.2);}/*!sc*/
* .shadow24{box-shadow:0px 24px 38px rgba(0,0,0,0.14),0px 9px 46px rgba(0,0,0,0.12),0px 11px 15px rgba(0,0,0,0.2);}/*!sc*/
* .debug-r{border:1px solid #f00;padding:2px;}/*!sc*/
* .debug-p{border:9px solid #f0f;padding:2px;}/*!sc*/
* .debug-b{border:6px solid #00f;padding:2px;}/*!sc*/
img,iframe{loading:lazy;}/*!sc*/
h1{font-size:6em;}/*!sc*/
h2{font-size:4em;}/*!sc*/
h3{font-size:3em;}/*!sc*/
h4{font-size:2em;}/*!sc*/
h5{font-size:1.5em;}/*!sc*/
h6{font-size:1.25em;}/*!sc*/
a{color:#177CB0;}/*!sc*/
hr.style1{border-top:1px solid #8c8b8b;}/*!sc*/
hr.style2{border-top:3px double #8c8b8b;}/*!sc*/
hr.style3{border-top:1px dashed #8c8b8b;}/*!sc*/
hr.style4{border-top:1px dotted #8c8b8b;}/*!sc*/
hr.style5{background-color:#fff;border-top:2px dashed #8c8b8b;}/*!sc*/
hr.style6{background-color:#fff;border-top:2px dotted #8c8b8b;}/*!sc*/
hr.style7{border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style8{border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style8:after{content:'';display:block;margin-top:2px;border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style9{border-top:1px dashed #8c8b8b;border-bottom:1px dashed #fff;}/*!sc*/
hr.style10{border-top:1px dotted #8c8b8b;border-bottom:1px dotted #fff;}/*!sc*/
hr.style11{height:6px;background:url(http://ibrahimjabbari.com/images/hr-11.png) repeat-x 0 0;border:0;}/*!sc*/
hr.style12{height:6px;background:url(http://ibrahimjabbari.com/images/hr-12.png) repeat-x 0 0;border:0;}/*!sc*/
hr.style13{height:10px;border:0;box-shadow:0 10px 10px - 10px #8c8b8b inset;}/*!sc*/
hr.style14{border:0;height:1px;background-image:-webkit-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-moz-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-ms-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-o-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);}/*!sc*/
hr.style15{border-top:4px double #8c8b8b;text-align:center;}/*!sc*/
hr.style15:after{content:'\002665';display:inline-block;position:relative;top:-15px;padding:0 10px;background:#f0f0f0;color:#8c8b8b;font-size:36px;}/*!sc*/
hr.style16{border-top:2px dashed #8c8b8b;}/*!sc*/
hr.style16:after{content:'\002702';display:inline-block;position:relative;top:-20px;left:40px;padding:0 64px;background:#f0f0f0;color:#8c8b8b;font-size:28px;}/*!sc*/
hr.style17{border-top:2px solid #8c8b8b;text-align:center;}/*!sc*/
hr.style17:after{content:'Â§';display:inline-block;position:relative;top:-16px;padding:0 10px;background:#f0f0f0;color:#8c8b8b;font-size:28px;-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);}/*!sc*/
.style18{height:30px;border-style:solid;border-color:#8c8b8b;border-width:1px 0 0 0;border-radius:20px;}/*!sc*/
hr.style18:before{display:block;content:"";height:30px;margin-top:-31px;border-style:solid;border-color:#8c8b8b;border-width:0 0 1px 0;border-radius:20px;}/*!sc*/
body{font-family:Helvetica,Tahoma,Arial,STXihei,"åæ–‡ç»†é»‘",Heiti,"é»‘ä½“","Microsoft YaHei","å¾®è½¯é›…é»‘",SimSun,"å®‹ä½“",sans-serif;font-size:16px;color:#3E3C3D;}/*!sc*/
data-styled.g79[id="sc-global-dfRwPU1"]{content:"sc-global-dfRwPU1,"}/*!sc*/
.TUexl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;gap:1rem;position:relative;}/*!sc*/
@media screen and (max-width:767px){.TUexl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}}/*!sc*/
data-styled.g92[id="blog__BodyContainer-sc-1pczva4-0"]{content:"TUexl,"}/*!sc*/
.dGDPjr{background-color:#fff;border-radius:8px;padding:1rem;}/*!sc*/
data-styled.g93[id="blog__Card-sc-1pczva4-1"]{content:"dGDPjr,"}/*!sc*/
.fdKA-DO{text-align:center;padding:0 0 1rem;border-bottom:1px solid rgba(62,60,61,0.3);}/*!sc*/
.fdKA-DO h1{font-size:2.5rem;line-height:5rem;}/*!sc*/
data-styled.g94[id="blog__BlogHeaderArea-sc-1pczva4-2"]{content:"fdKA-DO,"}/*!sc*/
.fELIiZ{margin-top:.6em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:.5rem;font-size:.8rem;}/*!sc*/
data-styled.g95[id="blog__TagContainer-sc-1pczva4-3"]{content:"fELIiZ,"}/*!sc*/
</style><title data-react-helmet="true">Kubernetes (k8s) é›†ç¾¤å®‰è£…éƒ¨ç½²</title><link as="script" rel="preload" href="/webpack-runtime-296e45abb59c73c4f920.js"/><link as="script" rel="preload" href="/framework-7818d66ac74a4e73b7d9.js"/><link as="script" rel="preload" href="/app-5eb7f4b936cd59e66508.js"/><link as="script" rel="preload" href="/commons-a78b4ea03bcf3a3c4608.js"/><link as="script" rel="preload" href="/component---src-templates-blog-js-8773661a13c005fdef8e.js"/><link as="fetch" rel="preload" href="/page-data/blog/20210125003_k8s_cluster_setup/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3208650349.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3659731985.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><section height="4rem" color="#F3F9F1" class="Layout__Section-sc-1bdq7wd-3 cRFnth relative-position z-level-800"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><section height="4rem" color="#F3F9F1" class="Layout__Section-sc-1bdq7wd-3 dvhtpb xxxx relative-position z-level-800"><div height="100%" class="Common__Container-sc-qqf9b1-0 iBUILR flex-between align-center debug-rx"><div width="36px" color="#fff" class="common__SVGContainer-sc-5wxmvs-0 feDaHt"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></div><p class="ft-20"><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/">ğŸ’¯âœ¨</a></p><div width="36px" color="#fff" class="common__SVGContainer-sc-5wxmvs-0 feDaHt"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div></section></div></section><section style="min-height:100vh" class="Layout__Section-sc-1bdq7wd-3 eJzqUT"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><div class="Common__Container-sc-qqf9b1-0 blog__BodyContainer-sc-1pczva4-0 bihRCo TUexl"><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 bihRCo dGDPjr debugx" style="flex:1"><div class="Common__Container-sc-qqf9b1-0 blog__BlogHeaderArea-sc-1pczva4-2 ebstCf fdKA-DO"><h1>Kubernetes (k8s) é›†ç¾¤å®‰è£…éƒ¨ç½²</h1><p class="ft-0.9" style="color:rgba(62, 60, 61, 0.6)"><span>ä½œè€…ï¼š</span><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?authors=Chris Wei"><span style="color:#E47542">Chris Wei</span></a>Â Â Â Â <span>æ—¶é—´ï¼š</span><span style="color:#E47542">2021-01-25</span>Â Â Â Â <span>åˆ†ç±»ï¼š</span><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?category=æŒ‡å¯¼æ‰‹å†Œ"><span style="color:#E47542">æŒ‡å¯¼æ‰‹å†Œ</span></a></p></div><div class="Markdownstyle__Markdown2HTMLStyle1-sc-1sf8evq-0 hmfyXj"><h1>Kubernetes (k8s) é›†ç¾¤å®‰è£…éƒ¨ç½²</h1>
<h2>ç¯å¢ƒæ¦‚è¿°</h2>
<ul>
<li>é˜¿é‡Œäº‘ (athena) ECS (2C 8G) x2</li>
<li>CentOS 7.8</li>
<li>kubernetes 1.18</li>
<li>[Master Public IP] ([Master Private IP]): k8s-m1 (master)</li>
<li>[Worker Public IP] ([Worker Private IP]): k8s-w1 (worker)</li>
</ul>
<h2>å‡†å¤‡å·¥ä½œ</h2>
<h4>æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬</h4>
<pre><code># cat /etc/redhat-release
CentOS Linux release 7.8.2003 (Core)
</code></pre>
<h4>æ£€æŸ¥å¹¶ä¿®æ”¹æœºå™¨åç§°</h4>
<pre><code># hostname
# hostnamectl
# cat /etc/hostname
</code></pre>
<pre><code># vi /etc/hostname
</code></pre>
<pre><code>k8s-m1
</code></pre>
<pre><code># systemctl restart systemd-hostnamed
</code></pre>
<pre><code># reboot
</code></pre>
<h4>é…ç½®é›†ç¾¤ hosts (ç§æœ‰åœ°å€)</h4>
<pre><code># vi /etc/hosts
</code></pre>
<pre><code>[Master Private IP] k8s-m1
[Worker Private IP] k8s-w1
</code></pre>
<h4>ç¦ç”¨<code>é˜²ç«å¢™</code></h4>
<pre><code># systemctl stop firewalld &#x26;&#x26; systemctl disable firewalld
# systemctl stop firewalld
</code></pre>
<h4>ç¦ç”¨<code>selinux</code></h4>
<pre><code># setenforce 0
# sed -i '7s/enforcing/disabled/' /etc/selinux/config
</code></pre>
<pre><code># reboot
</code></pre>
<h4>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆ<code>/etc/sysctl.d/k8s.conf</code>ï¼‰</h4>
<blockquote>
<p>åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ å†…å®¹</p>
</blockquote>
<pre><code># cat >/etc/sysctl.d/k8s.conf &#x3C;&#x3C;EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF
</code></pre>
<blockquote>
<p>æ‰§è¡Œå‘½ä»¤ä½¿ä¹‹ç”Ÿæ•ˆ</p>
</blockquote>
<pre><code># modprobe br_netfilter &#x26;&#x26; sysctl -p /etc/sysctl.d/k8s.conf
</code></pre>
<h4>å®‰è£…ipvs</h4>
<blockquote>
<p>åˆ›å»ºæ–‡ä»¶å¹¶æ·»åŠ å†…å®¹ï¼ˆä¿è¯åœ¨èŠ‚ç‚¹é‡å¯åèƒ½è‡ªåŠ¨åŠ è½½æ‰€éœ€æ¨¡å—ï¼‰</p>
</blockquote>
<pre><code># cat > /etc/sysconfig/modules/ipvs.modules &#x3C;&#x3C;EOF
#!/bin/bash
modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack_ipv4
EOF
</code></pre>
<blockquote>
<p>ä¿®æ”¹æƒé™ä»¥åŠæŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—</p>
</blockquote>
<pre><code># chmod 755 /etc/sysconfig/modules/ipvs.modules &#x26;&#x26; bash /etc/sysconfig/modules/ipvs.modules
</code></pre>
<blockquote>
<p>æŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—</p>
</blockquote>
<pre><code># lsmod | grep -e ip_vs -e nf_conntrack_ipv4
nf_conntrack_ipv4      15053  0 
nf_defrag_ipv4         12729  1 nf_conntrack_ipv4
ip_vs_sh               12688  0 
ip_vs_wrr              12697  0 
ip_vs_rr               12600  0 
ip_vs                 145497  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr
nf_conntrack          139264  2 ip_vs,nf_conntrack_ipv4
libcrc32c              12644  2 ip_vs,nf_conntrack
</code></pre>
<blockquote>
<p>å®‰è£… <code>ipset</code> å’Œ <code>ipvsadm</code> (ä¾¿äºæŸ¥çœ‹ ipvs çš„ä»£ç†è§„åˆ™)</p>
</blockquote>
<pre><code># yum -y install ipset ipvsadm
</code></pre>
<h4>åŒæ­¥æœåŠ¡å™¨æ—¶é—´</h4>
<blockquote>
<p>å®‰è£…chrony</p>
</blockquote>
<pre><code># yum -y install chrony
</code></pre>
<blockquote>
<p>ä¿®æ”¹åŒæ­¥æœåŠ¡å™¨åœ°å€ä¸ºé˜¿é‡Œäº‘</p>
</blockquote>
<pre><code># sed -i.bak '3,6d' /etc/chrony.conf &#x26;&#x26; sed -i '3cserver ntp1.aliyun.com iburst' /etc/chrony.conf
</code></pre>
<blockquote>
<p>å¯åŠ¨<code>chronyd</code>åŠåŠ å…¥å¼€æœºè‡ªå¯</p>
</blockquote>
<pre><code># systemctl start chronyd &#x26;&#x26; systemctl enable chronyd
</code></pre>
<blockquote>
<p>æŸ¥çœ‹åŒæ­¥ç»“æœ</p>
</blockquote>
<pre><code># chronyc sources
</code></pre>
<h4>å…³é—­<code>swap</code>åˆ†åŒº</h4>
<blockquote>
<p>æ‰‹åŠ¨å…³é—­swap</p>
</blockquote>
<pre><code># swapoff -a
</code></pre>
<blockquote>
<p>ä¿®æ”¹fstabæ–‡ä»¶ï¼Œæ³¨é‡Šswapè‡ªåŠ¨æŒ‚è½½ (!!!!!! æ­¤å¤„æœ‰äº›é—®é¢˜ï¼šè²Œä¼¼åŸæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰è¿™å¥è¯ï¼Œå› æ­¤è¿™ä¸ªå‘½ä»¤å®é™…å¹¶æœªå‘ç”Ÿä½œç”¨ !!!!!!)</p>
</blockquote>
<pre><code># sed -i '/^\/dev\/mapper\/centos-swap/c#/dev/mapper/centos-swap swap                    swap    defaults        0 0' /etc/fstab
</code></pre>
<blockquote>
<p>æŸ¥çœ‹swapæ˜¯å¦å…³é—­</p>
</blockquote>
<pre><code># free -m
              total        used        free      shared  buff/cache   available
Mem:           7821         123        7395           0         301        7472
Swap:             0           0           0
</code></pre>
<blockquote>
<p><code>swappiness</code> å‚æ•°è°ƒæ•´ï¼Œä¿®æ”¹<code>/etc/sysctl.d/k8s.conf</code>æ·»åŠ ä¸‹é¢ä¸€è¡Œ</p>
</blockquote>
<pre><code># cat >>/etc/sysctl.d/k8s.conf &#x3C;&#x3C;EOF
vm.swappiness=0
EOF
</code></pre>
<blockquote>
<p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
</blockquote>
<pre><code># sysctl -p /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
vm.swappiness = 0
</code></pre>
<h2>å®‰è£…</h2>
<h4>å®‰è£… Docker18.09.9</h4>
<blockquote>
<p>å®‰è£… <code>yum-utils</code> å‘½ä»¤åŒ…ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ <code>yum-config-manager</code> å‘½ä»¤</p>
</blockquote>
<pre><code>yum -y install yum-utils
</code></pre>
<blockquote>
<p>æ·»åŠ é˜¿é‡Œäº‘yumæº</p>
</blockquote>
<pre><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre>
<blockquote>
<p>æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬</p>
</blockquote>
<pre><code>yum list docker-ce --showduplicates | sort -r
å·²åŠ è½½æ’ä»¶ï¼šfastestmirror, langpacks
å¯å®‰è£…çš„è½¯ä»¶åŒ…
 * updates: mirrors.aliyun.com
Loading mirror speeds from cached hostfile
 * extras: mirrors.aliyun.com
docker-ce.x86_64            3:19.03.5-3.el7                     docker-ce-stable
docker-ce.x86_64            3:19.03.4-3.el7                     docker-ce-stable
ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
docker-ce.x86_64            3:18.09.9-3.el7                     docker-ce-stable
docker-ce.x86_64            3:18.09.8-3.el7                     docker-ce-stable
docker-ce.x86_64            3:18.09.7-3.el7                     docker-ce-stable
docker-ce.x86_64            3:18.09.6-3.el7                     docker-ce-stable
ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
</code></pre>
<blockquote>
<p>å®‰è£…docker18.09.9</p>
</blockquote>
<pre><code>yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9
</code></pre>
<blockquote>
<p>å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯</p>
</blockquote>
<pre><code>systemctl enable docker &#x26;&#x26; systemctl start docker
</code></pre>
<blockquote>
<p>é…ç½®é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ</p>
</blockquote>
<pre><code>cat > /etc/docker/daemon.json &#x3C;&#x3C;-'EOF'
{
  "registry-mirrors": ["https://gqk8w9va.mirror.aliyuncs.com"]
}
EOF
</code></pre>
<blockquote>
<p>é…ç½®å®Œåé‡å¯docker</p>
</blockquote>
<pre><code>systemctl restart docker
</code></pre>
<blockquote>
<p>æŸ¥çœ‹åŠ é€Ÿ</p>
</blockquote>
<pre><code>docker info
</code></pre>
<p>æ‰¾åˆ°Registry Mirrorsä¸€è¡Œ
Registry Mirrors:
<a href="https://gqk8w9va.mirror.aliyuncs.com/">https://gqk8w9va.mirror.aliyuncs.com/</a></p>
<blockquote>
<p>æŸ¥çœ‹dockerç‰ˆæœ¬</p>
</blockquote>
<pre><code>docker version

Client:
 Version:           18.09.9
 API version:       1.39
 Go version:        go1.11.13
 Git commit:        039a7df9ba
 Built:             Wed Sep  4 16:51:21 2019
 OS/Arch:           linux/amd64
 Experimental:      false

Server: Docker Engine - Community
 Engine:
  Version:          18.09.9
  API version:      1.39 (minimum version 1.12)
  Go version:       go1.11.13
  Git commit:       039a7df
  Built:            Wed Sep  4 16:22:32 2019
  OS/Arch:          linux/amd64
  Experimental:     false
</code></pre>
<h4>ä¿®æ”¹<code>docker Cgroup Driver</code>ä¸º<code>systemd</code></h4>
<blockquote>
<p>å°†/usr/lib/systemd/system/docker.serviceæ–‡ä»¶ä¸­çš„è¿™ä¸€è¡Œ ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
ä¿®æ”¹ä¸º ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd
å¦‚æœä¸ä¿®æ”¹ï¼Œåœ¨æ·»åŠ  worker èŠ‚ç‚¹æ—¶å¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹é”™è¯¯
[WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd".</p>
</blockquote>
<p>Please follow the guide at <a href="https://kubernetes.io/docs/setup/cri/">https://kubernetes.io/docs/setup/cri/</a></p>
<blockquote>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹</p>
</blockquote>
<pre><code>sed -i.bak "s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g" /usr/lib/systemd/system/docker.service
</code></pre>
<blockquote>
<p>é‡å¯docker</p>
</blockquote>
<pre><code>systemctl daemon-reload &#x26;&#x26; systemctl restart docker
</code></pre>
<h4>å®‰è£…<code>Kubeadm</code></h4>
<blockquote>
<p>ä½¿ç”¨é˜¿é‡Œäº‘<code>yum</code>æº</p>
</blockquote>
<pre><code>cat >/etc/yum.repos.d/kubernetes.repo &#x3C;&#x3C;EOF
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre>
<blockquote>
<p>å®‰è£… <code>kubeadm</code>ã€<code>kubelet</code>ã€<code>kubectl</code> (é˜¿é‡Œäº‘yumæºä¼šéšå®˜æ–¹æ›´æ–°æœ€æ–°ç‰ˆï¼Œå› æ­¤æŒ‡å®šç‰ˆæœ¬)</p>
</blockquote>
<blockquote>
<p>å®‰è£…1.18.4ç‰ˆæœ¬</p>
</blockquote>
<pre><code>yum -y install kubelet-1.18.4 kubeadm-1.18.4 kubectl-1.18.4
</code></pre>
<blockquote>
<p>æŸ¥çœ‹ç‰ˆæœ¬</p>
</blockquote>
<pre><code>kubeadm version

kubeadm version: &#x26;version.Info{Major:"1", Minor:"16", GitVersion:"v1.18.4", GitCommit:"a17149e1a189050796ced469dbd78d380f2ed5ef", GitTreeState:"clean", BuildDate:"2020-04-16T11:42:30Z", GoVersion:"go1.13.9", Compiler:"gc", Platform:"linux/amd64"}
</code></pre>
<blockquote>
<p>è®¾ç½®<code>kubelet</code>å¼€æœºè‡ªå¯</p>
</blockquote>
<pre><code>systemctl enable kubelet
</code></pre>
<blockquote>
<p>è®¾ç½®<code>k8s</code>å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</p>
</blockquote>
<pre><code>yum -y install bash-completion
source /usr/share/bash-completion/bash_completion
source &#x3C;(kubectl completion bash)
echo "source &#x3C;(kubectl completion bash)" >> ~/.bashrc
</code></pre>
<h1>åˆå§‹åŒ–é›†ç¾¤</h1>
<h2>åˆå§‹åŒ– <code>master</code> èŠ‚ç‚¹</h2>
<h4>é…ç½® <code>kubeadm</code> åˆå§‹åŒ–æ–‡ä»¶</h4>
<pre><code>cat &#x3C;&#x3C;EOF > ./kubeadm-config.yaml
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.18.3
imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers

#masteråœ°å€
controlPlaneEndpoint: "[Mater Private IP]:6443"	
networking:
  serviceSubnet: "10.96.0.0/16"	

  #k8så®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µ
  podSubnet: "10.20.0.1/16"	
  dnsDomain: "cluster.local"

# ä¸ºäº†è®©è¯ä¹¦åŒ…å«å…¬ç½‘IPï¼Œä»è€Œå…è®¸ä»å¤–ç½‘è®¿é—®é›†ç¾¤
apiServer:
  certSANs:       #å¡«å†™æ‰€æœ‰kube-apiserverèŠ‚ç‚¹çš„hostnameã€IPã€VIP
  - k8s-m1        #è¯·æ›¿æ¢ä¸ºhostname
  - [Master Public IP]  #è¯·æ›¿æ¢ä¸ºå…¬ç½‘
  - [Mater Private IP]  #è¯·æ›¿æ¢ä¸ºç§ç½‘
  - 10.96.0.1     #ä¸è¦æ›¿æ¢ï¼Œæ­¤IPæ˜¯APIçš„é›†ç¾¤åœ°å€ï¼Œéƒ¨åˆ†æœåŠ¡ä¼šç”¨åˆ°

EOF
</code></pre>
<h4>åˆå§‹åŒ– <code>master</code></h4>
<blockquote>
<p>âš ï¸å¦‚æœæƒ³è¦é‡æ–°åˆå§‹åŒ–ï¼Œéœ€è¦æ‰§è¡Œå‘½ä»¤ <code>kubeadm reset -f</code></p>
</blockquote>
<blockquote>
<p><code>kubeadm init --config=kubeadm-config.yaml --upload-certs</code></p>
</blockquote>
<pre><code># kubeadm init --config=kubeadm-config.yaml

....

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of control-plane nodes by copying certificate authorities
and service account keys on each node and then running the following as root:

  kubeadm join [Mater Private IP]:6443 --token xxxxxx.xxxxxxxxxxxxxxxxx \
    --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \
    --control-plane 

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join [Mater Private IP]:6443 --token xxxxxx.xxxxxxxxxxxxxxxxx \
    --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 

</code></pre>
<blockquote>
<p>âš ï¸ ä¿å­˜ token sha256</p>
</blockquote>
<blockquote>
<p>æ‹·è´ <code>kubeconfig</code> æ–‡ä»¶ï¼ˆè¿™é‡Œçš„è·¯å¾„ä¸º <code>/root</code>ï¼‰</p>
</blockquote>
<pre><code>mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<h2>åˆå§‹åŒ– <code>worker</code> èŠ‚ç‚¹</h2>
<blockquote>
<p>å°†masterèŠ‚ç‚¹ä¸Šçš„ <code>$HOME/.kube/config</code> æ–‡ä»¶æ‹·è´åˆ° <code>worker</code> èŠ‚ç‚¹å¯¹åº”çš„æ–‡ä»¶ä¸­</p>
</blockquote>
<pre><code>mkdir -p $HOME/.kube 
scp k8s-m1:~/.kube/config $HOME/.kube
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<blockquote>
<p>å°† <code>worker</code> èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­</p>
</blockquote>
<blockquote>
<p>è¿™é‡Œéœ€è¦ç”¨åˆ°2.2ä¸­åˆå§‹åŒ–masteræœ€åç”Ÿæˆçš„tokenå’Œsha256å€¼</p>
</blockquote>
<pre><code>kubeadm join [Mater Private IP]:6443 --token xxxxxx.xxxxxxxxxxxxxxxxx \
    --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 

... ...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</code></pre>
<blockquote>
<p>å¦‚æœå¿˜è®°äº†tokenå’Œsha256å€¼ï¼Œå¯ä»¥åœ¨masterèŠ‚ç‚¹ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹</p>
</blockquote>
<pre><code>#kubeadm token list
TOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION   EXTRA GROUPS
px979r.mphk9ee5ya8fgy44   20h       2020-03-18T13:49:48+08:00   authentication,signing   &#x3C;none>        system:bootstrappers:kubeadm:default-node-token
</code></pre>
<blockquote>
<p>æŸ¥çœ‹sha256</p>
</blockquote>
<pre><code>#openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<blockquote>
<p>åŒæ—¶æŸ¥çœ‹tokenå’Œsha256</p>
</blockquote>
<pre><code>#kubeadm token create --print-join-command
kubeadm join 192.168.9.10:6443 --token 9b28zg.oyt0kvvpmtrem4bg     --discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<blockquote>
<p>masterèŠ‚ç‚¹æŸ¥çœ‹nodeï¼ˆå‘ç°çŠ¶æ€éƒ½æ˜¯NotReadyï¼Œå› ä¸ºè¿˜æ²¡æœ‰å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å®‰è£…calioå®˜æ–¹æ’ä»¶æ–‡æ¡£ï¼‰</p>
</blockquote>
<pre><code>kubectl get nodes
</code></pre>
<h2><code>Master</code> èŠ‚ç‚¹å®‰è£…ç½‘ç»œæ’ä»¶calio</h2>
<blockquote>
<p>ä¸‹è½½æ–‡ä»¶</p>
</blockquote>
<pre><code>wget https://docs.projectcalico.org/v3.8/manifests/calico.yaml
</code></pre>
<blockquote>
<p>å› ä¸ºåœ¨ä¸Šè¾¹kubeadm-config.yamlé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†å®¹å™¨ç»„IPï¼Œæ‰€ä»¥éœ€è¦å°†æ–‡ä»¶ä¸­çš„<code>625</code>è¡Œæ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
</blockquote>
<pre><code>value: "10.20.0.1/16"
</code></pre>
<blockquote>
<p>vi å‘½ä»¤</p>
</blockquote>
<pre><code>:set number
</code></pre>
<blockquote>
<p>ä¿®æ”¹å®Œæˆåå®‰è£…calicoç½‘ç»œæ’ä»¶</p>
</blockquote>
<pre><code>kubectl apply -f calico.yaml
</code></pre>
<blockquote>
<p>å®‰è£…å®Œæˆåç¨ç­‰ä¸€ä¼šæŸ¥çœ‹podsçŠ¶æ€</p>
</blockquote>
<pre><code>kubectl get pods -n kube-system
</code></pre>
<blockquote>
<p>æŸ¥çœ‹nodeçŠ¶æ€</p>
</blockquote>
<pre><code>kubectl get nodes 
</code></pre>
<h2>å¯åŠ¨ <code>LENS</code></h2>
<h4>é˜¿é‡Œäº‘å¼€é€š <code>6443</code> ç«¯å£</h4>
<h4>Lens æ·»åŠ é›†ç¾¤</h4>
<pre><code>cat ~/.kube/config
</code></pre>
<blockquote>
<p>IP ä¿®æ”¹ä¸ºå…¬ç½‘IP</p>
</blockquote>
<blockquote>
<p>ä¿®æ”¹å…¶ä¸­çš„ <code>context name</code> å’Œ <code>current-context: kubernetes-admin@kubernetes</code>ï¼Œæ¢ä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œä¸è¦ç”¨ç¼ºçœçš„ï¼Œä¼šé‡åå†²çª</p>
</blockquote>
<h4>å¯ç”¨é›†ç¾¤çš„ <code>Metrics</code> Feature</h4>
<blockquote>
<p>éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ‰èƒ½çœ‹åˆ°é›†ç¾¤ Dashboard</p>
</blockquote>
<h1>å‡†å¤‡é•œåƒ</h1>
<h4>é•œåƒåˆ—è¡¨</h4>
<ul>
<li>registry.cn-beijing.aliyuncs.com/[???]/worker:0.2.0-[???]</li>
<li>registry.cn-beijing.aliyuncs.com/[???]/service:0.2.0-[???]</li>
<li>registry.cn-beijing.aliyuncs.com/[???]/frontend:0.2.0-[???]</li>
<li>rabbitmq:3.8.2-alpine</li>
<li>postgres:12.1-alpine</li>
<li>node:12.14.1-alpine</li>
<li>redis:5.0.7-alpine</li>
<li>nginx:1.17.6-alpine</li>
<li>busybox</li>
</ul>
<h4>å‘½ä»¤ - ç™»å½•é˜¿é‡Œäº‘é•œåƒæœåŠ¡</h4>
<pre><code>docker login -u [user name] -p [password] registry.cn-hangzhou.aliyuncs.com
</code></pre>
<blockquote>
<p>å¯ä»¥å‚è€ƒé˜¿é‡Œäº‘é•œåƒæœåŠ¡çš„å‘½ä»¤è¡Œæç¤º</p>
</blockquote>
<h4>å‘½ä»¤ - è·å–é•œåƒ</h4>
<pre><code>docker pull
</code></pre>
<h1>å®‰è£… Git</h1>
<pre><code>yum install git
</code></pre>
<h1>è·å– Demo è„šæœ¬</h1>
<blockquote>
<p>git repo of dockerimages</p>
</blockquote>
<pre><code>#!/bin/bash
git clone --depth=1 https://[user name]:[password]@github.com/YunzhiWei/dockerimages.git
</code></pre>
<h1>å¯åŠ¨ Ingress</h1>
<h2>Ingress Controller of Traefik</h2>
<blockquote>
<p>åˆ‡æ¢åˆ° <code>architecture/traefik</code> ç›®å½•</p>
</blockquote>
<h4>Apply rbac role and role binding</h4>
<pre><code># kubectl apply -f traefik-rbac.yaml
# kubectl describe clusterrole traefik-ingress-controller -n kube-system
</code></pre>
<h4>Apply daemonset</h4>
<pre><code>kubectl apply -f traefik-ds-http.yaml
kubectl get all -n kube-system | grep traefik
</code></pre>
<h1>æœåŠ¡å™¨é‡å¯åï¼Œk8s é‡å¯å¤±è´¥</h1>
<h2>å‚è€ƒ</h2>
<p><a href="https://www.hangge.com/blog/cache/detail_2419.html">https://www.hangge.com/blog/cache/detail_2419.html</a>
åŸæ–‡å‡ºè‡ªï¼š<a href="http://www.hangge.com">www.hangge.com</a>  è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥ï¼š<a href="https://www.hangge.com/blog/cache/detail_2419.html">https://www.hangge.com/blog/cache/detail_2419.html</a></p>
<h2>èƒŒæ™¯åŠç°è±¡</h2>
<p>åœ¨å®‰è£…é…ç½®å¥½ Kubernetes åï¼Œæ­£å¸¸æƒ…å†µä¸‹æœåŠ¡å™¨å…³æœºé‡å¯ï¼Œkubelet ä¹Ÿä¼šè‡ªåŠ¨å¯åŠ¨çš„ã€‚
ä½†æœ€è¿‘é…ç½®çš„ä¸€å°æœåŠ¡å™¨é‡å¯åï¼Œè¾“å…¥å‘½ä»¤ <code>kubectl get nodes</code> æŸ¥çœ‹èŠ‚ç‚¹æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š
<code>The connection to the server xxx.xxx.xxx.xxx:6443 was refused - did you specify the right host or port?</code></p>
<h2>æ£€æŸ¥</h2>
<p>è¾“å…¥ <code>systemctl status kubelet</code> å‘½ä»¤æŸ¥çœ‹ <code>kubelet</code> çš„æƒ…å†µ</p>
<blockquote>
<p>å‘ç° kubelet ç¡®å®æ²¡æœ‰å¯åŠ¨</p>
</blockquote>
<pre><code>... ...
code=exited, status=255
... ...
</code></pre>
<h2>åŸå› </h2>
<p>ç”±äº K8s å¿…é¡»ä¿æŒå…¨ç¨‹å…³é—­äº¤æ¢å†…å­˜ï¼Œä¹‹å‰æˆ‘å®‰è£…æ˜¯åªæ˜¯ä½¿ç”¨ swapoff -a å‘½ä»¤æš‚æ—¶å…³é—­ swapã€‚è€Œæœºå™¨é‡å¯åï¼Œswap è¿˜æ˜¯ä¼šè‡ªåŠ¨å¯ç”¨ï¼Œä»è€Œå¯¼è‡´ kubelet æ— æ³•å¯åŠ¨ã€‚</p>
<h2>è§£å†³åŠæ³•</h2>
<h4>é¦–å…ˆï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å…³é—­ swap</h4>
<pre><code>swapoff -a
</code></pre>
<h4>ç„¶åï¼Œç¼–è¾‘ /etc/fstab æ–‡ä»¶</h4>
<pre><code>vi /etc/fstab
</code></pre>
<p>å°† <code>/dev/mapper/centos-swap swap swap default 0 0</code> è¿™ä¸€è¡Œå‰é¢åŠ ä¸ª <code>#</code> å·å°†å…¶æ³¨é‡Šæ‰ã€‚</p>
<h2>é‡å¯æœåŠ¡å™¨</h2>
<h1>æ‰§è¡Œ kubectl å‘½ä»¤æŠ¥é”™ï¼šè¯ä¹¦è¿‡æœŸ</h1>
<h2>é”™è¯¯æç¤º</h2>
<blockquote>
<p><code>Unable to connect to the server: x509: certificate has expired or is not yet valid</code></p>
</blockquote>
<h2>å‚è€ƒ</h2>
<h4><a href="https://q.cnblogs.com/q/133037/">k8s master å‡ºç°é—®é¢˜è¯ä¹¦è¿‡æœŸé—®é¢˜</a></h4>
<pre><code>ç»è¿‡å®é™…éªŒè¯ï¼Œè§£å†³æ–¹æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¿è¡Œ2ä¸ªå‘½ä»¤ï¼š

1ï¼‰æ›´æ–°æ‰€æœ‰è¯ä¹¦

kubeadm alpha certs renew all

2ï¼‰æ›´æ–°å½“å‰ç”¨æˆ·çš„ .kube/config

cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
æ³¨ï¼šå¦‚æœå°‘äº†ç¬¬2æ­¥ï¼Œè¿è¡Œ kubectl å‘½ä»¤æ—¶ä¼šæŠ¥é”™

error: You must be logged in to the server (Unauthorized)
</code></pre>
<h4><a href="https://www.cnblogs.com/kuku0223/p/11867391.html">kubernets è¯ä¹¦è¿‡æœŸçš„é—®é¢˜</a></h4>
<blockquote>
<p>åŸç†åŠé¢„é˜²ï¼ˆä¼¼ä¹ç‰ˆæœ¬è¿‡è€ï¼Œç¨³é‡ç”¨çš„å‘½ä»¤<code>kubeadm alpha phase certs</code>ï¼Œå·²ç»æ”¹æˆäº†<code>kubeadm alpha certs</code>ï¼‰</p>
</blockquote>
<pre><code>kubeadm æ˜¯ kubernetes æä¾›çš„ä¸€ä¸ªåˆå§‹åŒ–é›†ç¾¤çš„å·¥å…·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯å®ƒåˆ›å»ºçš„apiserverã€controller-managerç­‰è¯ä¹¦é»˜è®¤åªæœ‰ä¸€å¹´çš„æœ‰æ•ˆæœŸï¼ŒåŒæ—¶kubelet è¯ä¹¦ä¹Ÿåªæœ‰ä¸€å¹´æœ‰æ•ˆæœŸï¼Œä¸€å¹´ä¹‹å kubernetes å°†åœæ­¢æœåŠ¡ã€‚
å®˜æ–¹æ¨èä¸€å¹´ä¹‹å†…è‡³å°‘ç”¨ kubeadm upgrade æ›´æ–°ä¸€æ¬¡ kubernetes ç³»ç»Ÿï¼Œæ›´æ–°æ—¶ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚ä¸è¿‡ï¼Œåœ¨äº§çº¿ç¯å¢ƒæˆ–è€…æ— æ³•è¿æ¥å¤–ç½‘çš„ç¯å¢ƒé¢‘ç¹æ›´æ–° kubernetes ä¸å¤ªç°å®ã€‚
æˆ‘ä»¬å¯ä»¥åœ¨è¿‡æœŸä¹‹å‰æˆ–ä¹‹åï¼Œä½¿ç”¨kubeadm alpha phaseé‡Œçš„certså’Œkubeconfigå‘½ä»¤ï¼ŒåŒæ—¶é…åˆkubeletè¯ä¹¦è‡ªåŠ¨è½®æ¢æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
</code></pre>
<blockquote>
<p>æ“ä½œæ³¨æ„äº‹é¡¹</p>
</blockquote>
<pre><code>ä¸€æ—¦è¯ä¹¦è¿‡æœŸï¼Œä½¿ç”¨kubectlæ—¶ä¼šå‡ºç°å¦‚ä¸‹æç¤ºï¼š
Unable to connect to the server: x509: certificate has expired or is not yet valid
åœ¨æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ kubeadm alpha phase certs ç³»ç»Ÿå‘½ä»¤ï¼Œé‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚
å»ºè®®ä¸è¦é‡æ–°ç”Ÿæˆcaè¯ä¹¦ï¼Œå› ä¸ºæ›´æ–°äº†caè¯ä¹¦ï¼Œé›†ç¾¤èŠ‚ç‚¹å°±éœ€è¦æ‰‹å·¥æ“ä½œï¼Œæ‰èƒ½è®©é›†ç¾¤æ­£å¸¸(ä¼šæ¶‰åŠé‡æ–°join)ã€‚

æ“ä½œä¹‹å‰ï¼Œå…ˆå°†/etc/kubernetes/pkiä¸‹çš„è¯ä¹¦æ–‡ä»¶ï¼Œmvåˆ°å…¶å®ƒæ–‡ä»¶å¤¹ï¼Œä½œä¸ªä¸´æ—¶å¤‡ä»½ï¼Œä¸è¦åˆ é™¤ã€‚

kubeadm alpha phase certs etcd-healthcheck-client --config cluster.yaml
kubeadm alpha phase certs etcd-peer --config cluster.yaml
kubeadm alpha phase certs etcd-server --config cluster.yaml
kubeadm alpha phase certs front-proxy-client--config cluster.yaml
kubeadm alpha phase certs apiserver-etcd-client --config cluster.yaml
kubeadm alpha phase certs apiserver-kubelet-client --config cluster.yaml
kubeadm alpha phase certs apiserver --config cluster.yaml
kubeadm alpha phase certs sa --config cluster.yaml


åœ¨ç”Ÿæˆè¿™äº›æ–°çš„è¯ä¹¦æ–‡ä»¶ä¹‹åï¼Œå†éœ€è¦kubeadm alpha phase configå‘½ä»¤ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„kubeconfigæ–‡ä»¶ã€‚
æ“ä½œä¹‹å‰ï¼Œå…ˆå°†/etc/kubernetes/ä¸‹çš„kubeconfigï¼Œmvåˆ°å…¶å®ƒæ–‡ä»¶å¤¹ï¼Œä½œä¸ªä¸´æ—¶å¤‡ä»½ï¼Œä¸è¦åˆ é™¤ã€‚
kubeadm alpha phase kubeconfig all --config cluster.yaml

ç”±äºservice accountçš„å¯†é’¥æ˜¯ä»¥rsaå¯†é’¥å¯¹å½¢å¼ç”Ÿæˆï¼Œæ‰€ä»¥æ²¡æœ‰è¿‡æœŸæ—¶é—´ã€‚
å¦‚æ— å¿…è¦ï¼Œåƒä¸‡ä¸è¦ç”Ÿæˆé‡æ–°ç”Ÿæˆsaå¯†é’¥ã€‚å› ä¸ºsaå¯†é’¥å…³è”åˆ°ä¸€åˆ‡ç³»ç»Ÿpodå†…çš„è¿›ç¨‹è®¿é—®api serveræ—¶çš„è®¤è¯ã€‚
å¦‚æœæ›´æ–°äº†saï¼Œåˆ™éœ€è¦å…ˆé‡æ–°ç”Ÿæˆè¿™äº›podåŠ æˆªçš„tokenï¼Œå†åˆ é™¤è¿™äº›podä¹‹åï¼Œé‡æ–°åŠ è½½tokenæ–‡ä»¶ã€‚

</code></pre>
<h4><a href="http://t.zoukankan.com/qinghe123-p-12582393.html">kubeadmå®‰è£…çš„k8sé›†ç¾¤è¯ä¹¦è¿‡æœŸå¤„ç†</a></h4>
<h4><a href="https://blog.csdn.net/swan_tang/article/details/115755311">Unable to connect to the server: x509: certificate has expired or is not yet valid</a></h4>
<pre><code>1.  ç™»å½•masteræœåŠ¡å™¨ï¼Œè¿›å…¥ `/etc/kubernetes/` æŸ¥çœ‹è¯ä¹¦ï¼Œç¡®è®¤è¯ä¹¦æœ‰æ•ˆæœŸï¼šopenssl x509 -in apiserver.crt -noout -text |grep ' Not '
2.  å¤‡ä»½ `/etc/kubernetes/pki` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
3.* æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ `kubeadm alpha certs renew all`
4.  æŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯å¦æ›´æ–°
5.  åœ¨masterèŠ‚ç‚¹ä¸Šå°†/etc/kubernetesç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶å¤‡ä»½
6.  æ›´æ–°ç”¨æˆ·é…ç½®ï¼šæ‰§è¡Œä¸‹é¢å¤šä¸ªå‘½ä»¤

kubeadm alpha kubeconfig user --client-name=admin
kubeadm alpha kubeconfig user --org system:masters --client-name kubernetes-admin  > /etc/kubernetes/admin.conf
kubeadm alpha kubeconfig user --client-name system:kube-controller-manager > /etc/kubernetes/controller-manager.conf
kubeadm alpha kubeconfig user --org system:nodes --client-name system:node:$(hostname) > /etc/kubernetes/kubelet.conf
kubeadm alpha kubeconfig user --client-name system:kube-scheduler > /etc/kubernetes/scheduler.conf

7.* ç”¨æ›´æ–°åçš„admin.confæ›¿æ¢/root/.kube/configæ–‡ä»¶
8.  æ›´æ–°åï¼ŒæŠŠmaster èŠ‚ç‚¹æœåŠ¡å™¨çš„ homeç›®å½•ä¸‹çš„ .kube æ–‡ä»¶å¤¹ å¤åˆ¶åˆ°æœ¬æœºçš„/home/ç”¨æˆ·ç›®å½•ä¸‹
9.  é‡å¯æ‰€æœ‰masterèŠ‚ç‚¹ä¸Šçš„apiserverå’Œschedulerä¸¤ä¸ªç³»ç»Ÿç»„ä»¶
10. æœ¬æœºæ‰§è¡Œkubectl å‘½ä»¤

</code></pre>
<h2>é—®é¢˜çš„æ£€æŸ¥ç¡®è®¤åŠå¿…è¦å‡†å¤‡</h2>
<ol>
<li>
<p>ç™»å½• master èŠ‚ç‚¹</p>
</li>
<li>
<p>æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆç®€å•æŸ¥çœ‹ï¼‰</p>
</li>
</ol>
<pre><code>openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep ' Not '
</code></pre>
<ol start="3">
<li>è¯¦ç»†æŸ¥çœ‹</li>
</ol>
<pre><code>cd /etc/kubernetes
ls
</code></pre>
<pre><code>cd /etc/kubernetes/pki
openssl x509 -in apiserver.crt -noout -text |grep ' Not '
kubeadm alpha certs check-expiration
</code></pre>
<p>è¯¦ç»†ç»“æœ</p>
<pre><code>[root@k8s-m1 ~]# openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text |grep ' Not '
            Not Before: Jul  8 03:24:35 2020 GMT
            Not After : Jul  8 03:24:35 2021 GMT
</code></pre>
<pre><code>CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Jul 08, 2021 03:24 UTC   &#x3C;invalid>                               no      
apiserver                  Jul 08, 2021 03:24 UTC   &#x3C;invalid>       ca                      no      
apiserver-etcd-client      Jul 08, 2021 03:24 UTC   &#x3C;invalid>       etcd-ca                 no      
apiserver-kubelet-client   Jul 08, 2021 03:24 UTC   &#x3C;invalid>       ca                      no      
controller-manager.conf    Jul 08, 2021 03:24 UTC   &#x3C;invalid>                               no      
etcd-healthcheck-client    Jul 08, 2021 03:24 UTC   &#x3C;invalid>       etcd-ca                 no      
etcd-peer                  Jul 08, 2021 03:24 UTC   &#x3C;invalid>       etcd-ca                 no      
etcd-server                Jul 08, 2021 03:24 UTC   &#x3C;invalid>       etcd-ca                 no      
front-proxy-client         Jul 08, 2021 03:24 UTC   &#x3C;invalid>       front-proxy-ca          no      
scheduler.conf             Jul 08, 2021 03:24 UTC   &#x3C;invalid>                               no      

CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
ca                      Jul 06, 2030 03:24 UTC   8y              no      
etcd-ca                 Jul 06, 2030 03:24 UTC   8y              no      
front-proxy-ca          Jul 06, 2030 03:24 UTC   8y              no      
</code></pre>
<blockquote>
<p><code>ca</code>, <code>etcd-ca</code>, <code>front-proxy-ca</code> è¿™ä¸‰ä¸ªè¯ä¹¦æœ‰æ•ˆæœŸ8å¹´ï¼Œå¹¶æœªè¿‡æœŸã€‚å…¶ä»– 10 ä¸ªè¯ä¹¦å·²ç»è¿‡æœŸã€‚</p>
</blockquote>
<ol start="4">
<li>å¤‡ä»½è¯ä¹¦ åŠ k8s é…ç½®æ–‡ä»¶</li>
</ol>
<pre><code>cd /
cd ~
mkdir backup
cp -r /etc/kubernetes ./backup/etc_k8s
ls ./backup/etc_k8s/
</code></pre>
<ol start="5">
<li>
<p>ç™»å½• k8s å·¥ä½œèŠ‚ç‚¹</p>
</li>
<li>
<p>æŸ¥æ‰¾ dbpg pod</p>
</li>
</ol>
<pre><code>docker ps
</code></pre>
<p>æ‰¾åˆ° <code>k8s_dbpg-container</code></p>
<ol start="7">
<li>è¿›å…¥å®¹å™¨</li>
</ol>
<pre><code>docker exec -it d7a /bin/bash
</code></pre>
<ol start="8">
<li>å¤‡ä»½æ•°æ®åº“</li>
</ol>
<pre><code>cd script
pg_dump -h dbpg -U postgres archellis > 20210717.yunzhi.bak
</code></pre>
<ol start="9">
<li>é€€å‡ºå®¹å™¨</li>
</ol>
<pre><code>exit
</code></pre>
<ol start="10">
<li>æ£€æŸ¥å¤‡ä»½æ–‡ä»¶</li>
</ol>
<pre><code>cd ~/projects/caskbank/database/script
ls
</code></pre>
<ol start="11">
<li>å¼‚åœ°å¤‡ä»½</li>
</ol>
<pre><code>scp 20210717.yunzhi.bak 172.17.64.152:~/projects/dbdump/
</code></pre>
<h2>é—®é¢˜è§£å†³çš„å®é™…æ“ä½œ</h2>
<ol>
<li>æ‰‹åŠ¨æ›´æ–°è¯ä¹¦</li>
</ol>
<pre><code>cd /etc/kubernetes/pki
kubeadm alpha certs renew all
</code></pre>
<ol start="2">
<li>æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ</li>
</ol>
<pre><code>openssl x509 -in apiserver.crt -noout -text |grep ' Not '
kubeadm alpha certs check-expiration
</code></pre>
<pre><code>[root@k8s-m1 pki]# openssl x509 -in apiserver.crt -noout -text |grep ' Not '
            Not Before: Jul  8 03:24:35 2020 GMT
            Not After : Jul 17 01:01:13 2022 GMT
</code></pre>
<pre><code>CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Jul 17, 2022 01:01 UTC   364d                                    no      
apiserver                  Jul 17, 2022 01:01 UTC   364d            ca                      no      
apiserver-etcd-client      Jul 17, 2022 01:01 UTC   364d            etcd-ca                 no      
apiserver-kubelet-client   Jul 17, 2022 01:01 UTC   364d            ca                      no      
controller-manager.conf    Jul 17, 2022 01:01 UTC   364d                                    no      
etcd-healthcheck-client    Jul 17, 2022 01:01 UTC   364d            etcd-ca                 no      
etcd-peer                  Jul 17, 2022 01:01 UTC   364d            etcd-ca                 no      
etcd-server                Jul 17, 2022 01:01 UTC   364d            etcd-ca                 no      
front-proxy-client         Jul 17, 2022 01:01 UTC   364d            front-proxy-ca          no      
scheduler.conf             Jul 17, 2022 01:01 UTC   364d                                    no      

CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
ca                      Jul 06, 2030 03:24 UTC   8y              no      
etcd-ca                 Jul 06, 2030 03:24 UTC   8y              no      
front-proxy-ca          Jul 06, 2030 03:24 UTC   8y              no   
</code></pre>
<ol start="3">
<li>æ›´æ–°ç”¨æˆ·é…ç½®</li>
</ol>
<pre><code>cd /etc/kubernetes

kubeadm alpha kubeconfig user --client-name=admin
kubeadm alpha kubeconfig user --org system:masters --client-name kubernetes-admin  > /etc/kubernetes/admin.conf
kubeadm alpha kubeconfig user --client-name system:kube-controller-manager > /etc/kubernetes/controller-manager.conf
kubeadm alpha kubeconfig user --org system:nodes --client-name system:node:$(hostname) > /etc/kubernetes/kubelet.conf
kubeadm alpha kubeconfig user --client-name system:kube-scheduler > /etc/kubernetes/scheduler.conf
</code></pre>
<ol start="4">
<li>master èŠ‚ç‚¹ config</li>
</ol>
<pre><code>cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<ol start="5">
<li>ç™»å½• <code>worker</code> èŠ‚ç‚¹</li>
</ol>
<blockquote>
<p>å°†masterèŠ‚ç‚¹ä¸Šçš„ <code>$HOME/.kube/config</code> æ–‡ä»¶æ‹·è´åˆ° <code>worker</code> èŠ‚ç‚¹å¯¹åº”çš„æ–‡ä»¶ä¸­</p>
</blockquote>
<pre><code>scp k8s-m1:~/.kube/config $HOME/.kube
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<ol start="6">
<li>é‡å¯ master èŠ‚ç‚¹æœåŠ¡ï¼ˆå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼‰</li>
</ol>
<pre><code>systemctl restart kube-apiserver
systemctl restart kube-scheduler
</code></pre>
<h2>é‡æ–°é…ç½® LENS</h2>
<ol>
<li>æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„å…¬ç½‘åœ°å€</li>
</ol>
<pre><code>cd ~
cat ./kubeadm-config.yaml
</code></pre>
<pre><code>apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: v1.18.3
imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers

#masteråœ°å€
controlPlaneEndpoint: "********:6443"
networking:
  serviceSubnet: "10.96.0.0/16"

  #k8så®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µ
  podSubnet: "10.20.0.1/16"
  dnsDomain: "cluster.local"

# ä¸ºäº†è®©è¯ä¹¦åŒ…å«å…¬ç½‘IPï¼Œä»è€Œå…è®¸ä»å¤–ç½‘è®¿é—®é›†ç¾¤
apiServer:
  certSANs:       #å¡«å†™æ‰€æœ‰kube-apiserverèŠ‚ç‚¹çš„hostnameã€IPã€VIP
  - k8s-m1        #è¯·æ›¿æ¢ä¸ºhostname
  - ********   #è¯·æ›¿æ¢ä¸ºå…¬ç½‘
  - ********   #è¯·æ›¿æ¢ä¸ºç§ç½‘
  - 10.96.0.1     #ä¸è¦æ›¿æ¢ï¼Œæ­¤IPæ˜¯APIçš„é›†ç¾¤åœ°å€ï¼Œéƒ¨åˆ†æœåŠ¡ä¼šç”¨åˆ°
</code></pre>
<ol start="2">
<li>æ£€æŸ¥</li>
</ol>
<pre><code>cd ~
cat ~/.kube/config
</code></pre>
<pre><code>apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS......LQo=
    server: https://***************:6443
  name: kubernetes
  
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes

kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS...........LQo=
    client-key-data: LS.........LQo=
</code></pre>
<ol start="3">
<li>
<p>å¤åˆ¶ä¸Šé¢çš„ config å†…å®¹</p>
</li>
<li>
<p>å¹¶ä¿®æ”¹å…¶ä¸­çš„ ***********:6443 ï¼Œ ä¿®æ”¹ä¸ºå…¬ç½‘åœ°å€</p>
</li>
<li>
<p>ä¿®æ”¹ context çš„ nameï¼Œå’Œ current-contextï¼ˆå¦åˆ™ï¼ŒLENSæ— æ³•æ·»åŠ ï¼‰</p>
</li>
</ol>
<blockquote>
<p>æ¯”å¦‚ï¼Œæ”¹ä¸ºï¼škubernetes-admin@kubernetesCMCC</p>
</blockquote>
<ol start="6">
<li>è¿›å…¥ LENS ï¼ŒAdd Clusterï¼Œpaste config</li>
</ol>
<h1>å‘½åç©ºé—´åˆ é™¤å¤±è´¥</h1>
<h2>ç°è±¡</h2>
<p>å‘½åç©ºé—´æ²¡æœ‰æ¶ˆå¤±ï¼ŒçŠ¶æ€å§‹ç»ˆåœ¨ <code>Terminating</code></p>
<h2>å‚è€ƒ</h2>
<ul>
<li><a href="https://q.cnblogs.com/q/125837/">K8s æ— æ³•åˆ é™¤ namespace çš„é—®é¢˜</a></li>
<li><a href="https://blog.csdn.net/wangchao_cn/article/details/112687355">k8s å¼ºåˆ¶åˆ é™¤å‘½åç©ºé—´namespace</a></li>
</ul>
<h2>è§£å†³åŠæ³•</h2>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<pre><code>kubectl get namespace caskbank-demo-ns -o json \
            | tr -d "\n" | sed "s/\"finalizers\": \[[^]]\+\]/\"finalizers\": []/" \
            | kubectl replace --raw /api/v1/namespaces/caskbank-demo-ns/finalize -f -
</code></pre>
<pre><code>kubectl get namespace [name of namespace] -o json \
            | tr -d "\n" | sed "s/\"finalizers\": \[[^]]\+\]/\"finalizers\": []/" \
            | kubectl replace --raw /api/v1/namespaces/[name of namespace]/finalize -f -
</code></pre>
<h2>ç‰¹åˆ«è¯´æ˜</h2>
<p>ä¸Šè¿°é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯è¯ä¹¦è¿‡æœŸçš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å‘½åç©ºé—´åˆ é™¤çš„é—®é¢˜ã€‚è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¯èƒ½æ˜¯è¿é”ååº”ã€‚
æœ€ç»ˆï¼Œè¿˜æ˜¯é‡å¯çš„ master å’Œ worker èŠ‚ç‚¹æœåŠ¡å™¨ï¼Œé›†ç¾¤æ‰æ¢å¤æ­£å¸¸ã€‚</p></div></div><div style="flex:none;min-width:10rem"><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 bihRCo dGDPjr"><table><tr><td><span class="ft-09">ä¸»é¢˜ï¼š</span><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?subject=äº‘åŸç”Ÿ"><span class="ft-08">äº‘åŸç”Ÿ</span></a></td></tr></table></div><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 jrwTuf dGDPjr"><p class="ft-09">Tags</p><span class="blog__TagContainer-sc-1pczva4-3 fELIiZ"><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?tags=kubernetes"><div class="Tag-sc-u31xqs-0 jaxOUy">kubernetes</div></a><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?tags=k8s"><div class="Tag-sc-u31xqs-0 jaxOUy">k8s</div></a><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?tags=Ingress"><div class="Tag-sc-u31xqs-0 jaxOUy">Ingress</div></a><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?tags=calico"><div class="Tag-sc-u31xqs-0 jaxOUy">calico</div></a><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?tags=LENS"><div class="Tag-sc-u31xqs-0 jaxOUy">LENS</div></a></span></div><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 jrwTuf dGDPjr"><p class="ft-09">Keywords</p><span class="blog__TagContainer-sc-1pczva4-3 fELIiZ"><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?keywords=kubeadm"><div class="Tag-sc-u31xqs-0 jaxOUy">kubeadm</div></a><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/?keywords=k8sé›†ç¾¤"><div class="Tag-sc-u31xqs-0 jaxOUy">k8sé›†ç¾¤</div></a></span></div><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 jrwTuf dGDPjr"><a href="https://www.gitee.com/Kubernetes (k8s) é›†ç¾¤å®‰è£…éƒ¨ç½²" target="_blank">Edit</a></div></div></div></div></section><section color="#F3F9F1" style="min-height:6rem;gap:1em" class="Layout__Section-sc-1bdq7wd-3 eGASSl text-align-center"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><p class="ft-08">Wechat: yunzhi76</p><p class="ft-08" style="margin-top:.8em">Copyright Â© 2022 WeReady</p><p class="ft-08" style="margin-top:.8em">äº¬ICPå¤‡17073797å·</p></div></section></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/20210125003_k8s_cluster_setup";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-208afb513f08e06527a2.js"],"app":["/app-5eb7f4b936cd59e66508.js"],"component---src-pages-adpsearch-tsx":["/component---src-pages-adpsearch-tsx-4bc5c6971497f7164b7e.js"],"component---src-pages-blogcatalog-tsx":["/component---src-pages-blogcatalog-tsx-20ae72ef6b0b2a4a3689.js"],"component---src-pages-component-badge-tsx":["/component---src-pages-component-badge-tsx-79183d381f77ba56476d.js"],"component---src-pages-component-button-tsx":["/component---src-pages-component-button-tsx-e4dd8b67ed07d25912f4.js"],"component---src-pages-component-carousel-tsx":["/component---src-pages-component-carousel-tsx-234d51eb59f9833dfb68.js"],"component---src-pages-component-highlight-tsx":["/component---src-pages-component-highlight-tsx-4761119ed5c7a88c280b.js"],"component---src-pages-component-image-tsx":["/component---src-pages-component-image-tsx-50473a233e801c77cecc.js"],"component---src-pages-component-index-tsx":["/component---src-pages-component-index-tsx-fec1ab34e98ad82239dd.js"],"component---src-pages-component-indicator-tsx":["/component---src-pages-component-indicator-tsx-94e31bd4b586245a769a.js"],"component---src-pages-component-link-tsx":["/component---src-pages-component-link-tsx-734f6fc5d0fb2201c6ce.js"],"component---src-pages-component-list-tsx":["/component---src-pages-component-list-tsx-049d22b19b58211aed20.js"],"component---src-pages-component-modal-tsx":["/component---src-pages-component-modal-tsx-9af039589785070adb41.js"],"component---src-pages-component-player-tsx":["/component---src-pages-component-player-tsx-d2e59cd7d465dc72210c.js"],"component---src-pages-component-tag-tsx":["/component---src-pages-component-tag-tsx-fdf842f1c345014323f7.js"],"component---src-pages-form-choice-tsx":["/component---src-pages-form-choice-tsx-03a499aee83378ee104e.js"],"component---src-pages-form-demo-1-tsx":["/component---src-pages-form-demo-1-tsx-644ac215e91c468a0fe1.js"],"component---src-pages-form-demo-2-tsx":["/component---src-pages-form-demo-2-tsx-69de8d1a63473507429b.js"],"component---src-pages-form-demo-3-tsx":["/component---src-pages-form-demo-3-tsx-40084f44ad933ab3b700.js"],"component---src-pages-form-demo-4-tsx":["/component---src-pages-form-demo-4-tsx-b3f4e11486d9ddadaf26.js"],"component---src-pages-form-index-tsx":["/component---src-pages-form-index-tsx-43c524074cea0ae45311.js"],"component---src-pages-form-login-tsx":["/component---src-pages-form-login-tsx-3de9f3631105e779e66c.js"],"component---src-pages-form-object-tsx":["/component---src-pages-form-object-tsx-d5a1a5c6065b4855f52f.js"],"component---src-pages-form-reset-tsx":["/component---src-pages-form-reset-tsx-847c9d178e4fa3e8b8ea.js"],"component---src-pages-ftsearch-tsx":["/component---src-pages-ftsearch-tsx-712087b505a6b6425d9d.js"],"component---src-pages-hook-index-tsx":["/component---src-pages-hook-index-tsx-149d24b439820013c255.js"],"component---src-pages-hook-timer-tsx":["/component---src-pages-hook-timer-tsx-69077e268bc0d9c7fcd1.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-5573a3c45e8ebc3f29be.js"],"component---src-pages-showcase-resource-tsx":["/component---src-pages-showcase-resource-tsx-6fa074714c7717fd9ab6.js"],"component---src-pages-uispec-color-tsx":["/component---src-pages-uispec-color-tsx-7c67920bbd8e417ba193.js"],"component---src-pages-uispec-cssborder-tsx":["/component---src-pages-uispec-cssborder-tsx-8a89ca265808937e3a1e.js"],"component---src-pages-uispec-divider-tsx":["/component---src-pages-uispec-divider-tsx-a2bececf6b29941d9a4d.js"],"component---src-pages-uispec-emoji-tsx":["/component---src-pages-uispec-emoji-tsx-956c3a515b688bacaad7.js"],"component---src-pages-uispec-index-tsx":["/component---src-pages-uispec-index-tsx-50a7562ea3f63c0829cb.js"],"component---src-pages-uispec-layers-tsx":["/component---src-pages-uispec-layers-tsx-e2adf987f78c4111a3ee.js"],"component---src-pages-uispec-layout-tsx":["/component---src-pages-uispec-layout-tsx-1539e6ddf66df8bf0da7.js"],"component---src-pages-uispec-shadow-tsx":["/component---src-pages-uispec-shadow-tsx-acee2d8c68fbc38627b5.js"],"component---src-pages-uispec-shape-tsx":["/component---src-pages-uispec-shape-tsx-5363bc42fccd2bd1f719.js"],"component---src-pages-uispec-svgicons-tsx":["/component---src-pages-uispec-svgicons-tsx-5a001c4c5afeb36ca8e9.js"],"component---src-pages-uispec-typography-tsx":["/component---src-pages-uispec-typography-tsx-3ec22df21500761f4ffa.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-8773661a13c005fdef8e.js"]};/*]]>*/</script><script src="/polyfill-208afb513f08e06527a2.js" nomodule=""></script><script src="/component---src-templates-blog-js-8773661a13c005fdef8e.js" async=""></script><script src="/commons-a78b4ea03bcf3a3c4608.js" async=""></script><script src="/app-5eb7f4b936cd59e66508.js" async=""></script><script src="/framework-7818d66ac74a4e73b7d9.js" async=""></script><script src="/webpack-runtime-296e45abb59c73c4f920.js" async=""></script></body></html>