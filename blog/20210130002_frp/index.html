<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.13.1"/><style data-styled="" data-styled-version="5.3.3">.eSCfig{width:auto;height:4rem;padding:0;margin:0;gap:normal;font-size:inherit;color:inherit;background:transparent;}/*!sc*/
.hpfWsV{width:auto;height:auto;padding:0;margin:0;gap:normal;font-size:inherit;color:inherit;background:transparent;}/*!sc*/
.eHike{width:auto;height:auto;padding:0;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:transparent;}/*!sc*/
.gixjse{width:auto;height:auto;padding:0;margin:1rem 0;gap:normal;font-size:inherit;color:inherit;background:transparent;}/*!sc*/
.cgUPym{width:auto;height:auto;padding:0;margin:1rem 0 0 0;gap:normal;font-size:inherit;color:inherit;background:transparent;}/*!sc*/
data-styled.g1[id="Common__Container-sc-qqf9b1-0"]{content:"eSCfig,hpfWsV,eHike,gixjse,cgUPym,"}/*!sc*/
.gttqhR{-webkit-text-decoration:none;text-decoration:none;color:#177CB0;}/*!sc*/
data-styled.g4[id="Link__Container-sc-zcsev2-0"]{content:"gttqhR,"}/*!sc*/
.eNGrUK{background:transparent;max-width:1080px;margin:0 auto;}/*!sc*/
data-styled.g16[id="Layout__CenterContainer-sc-1bdq7wd-0"]{content:"eNGrUK,"}/*!sc*/
.cRFnth{width:auto;height:4rem;padding:0 24px;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:#276893;}/*!sc*/
.eJzqUT{width:auto;height:auto;padding:.5rem;margin:0;gap:normal;font-size:inherit;color:inherit;background:rgba(62,60,61,0.1);}/*!sc*/
.eGASSl{width:auto;height:auto;padding:1.2rem 0;margin:0;gap:normal;font-size:inherit;color:#F3F9F1;background:#3E3C3D;}/*!sc*/
data-styled.g19[id="Layout__Section-sc-1bdq7wd-3"]{content:"cRFnth,eJzqUT,eGASSl,"}/*!sc*/
.ggvQtb{height:100%;}/*!sc*/
.ggvQtb a{-webkit-text-decoration:none;text-decoration:none;color:#F3F9F1;}/*!sc*/
.ggvQtb ul,.ggvQtb li{list-style:none;}/*!sc*/
.ggvQtb > ul{height:100%;}/*!sc*/
.ggvQtb li > ul{background:rgba(39,104,147,0.8);}/*!sc*/
data-styled.g27[id="Herizon__Container-sc-1o23vw7-0"]{content:"ggvQtb,"}/*!sc*/
.irUIDe{font-weight:400;position:relative;}/*!sc*/
.irUIDe > ul{display:none;}/*!sc*/
.irUIDe:hover{font-weight:700;}/*!sc*/
.irUIDe:hover > ul{display:block;border:1px solid #F3F9F1;position:absolute;bottom:0;left:0;top:auto;right:auto;-webkit-transform:translate(0,100%);-ms-transform:translate(0,100%);transform:translate(0,100%);}/*!sc*/
.irUIDe > ul:hover{display:block;}/*!sc*/
.irUIDe:hover > div.bottom:after{content:"";position:absolute;bottom:0px;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);width:0;height:0;border-bottom:solid .5em white;border-left:solid .5em transparent;border-right:solid .5em transparent;}/*!sc*/
.irUIDe:hover > div.right:after{content:"";position:absolute;right:0px;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);width:0;height:0;border-right:solid .5em white;border-top:solid .5em transparent;border-bottom:solid .5em transparent;}/*!sc*/
.pWylq{font-weight:400;position:relative;}/*!sc*/
.pWylq > ul{display:none;}/*!sc*/
.pWylq:hover{font-weight:700;}/*!sc*/
.pWylq:hover > ul{display:block;border:1px solid #F3F9F1;position:absolute;bottom:auto;left:auto;top:0;right:0;-webkit-transform:translate(100%,-1px);-ms-transform:translate(100%,-1px);transform:translate(100%,-1px);}/*!sc*/
.pWylq > ul:hover{display:block;}/*!sc*/
.pWylq:hover > div.bottom:after{content:"";position:absolute;bottom:0px;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);width:0;height:0;border-bottom:solid .5em white;border-left:solid .5em transparent;border-right:solid .5em transparent;}/*!sc*/
.pWylq:hover > div.right:after{content:"";position:absolute;right:0px;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);width:0;height:0;border-right:solid .5em white;border-top:solid .5em transparent;border-bottom:solid .5em transparent;}/*!sc*/
data-styled.g28[id="Herizon__ListItem-sc-1o23vw7-1"]{content:"irUIDe,pWylq,"}/*!sc*/
.dmaeiV{height:100%;padding:0.8em;position:relative;cursor:pointer;}/*!sc*/
data-styled.g29[id="Herizon__ItemContent-sc-1o23vw7-2"]{content:"dmaeiV,"}/*!sc*/
.wuwEJ{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;max-width:100%;min-height:100%;}/*!sc*/
.wuwEJ code{color:#F3F9F1;background:rgba(62,60,61,0.6);}/*!sc*/
.wuwEJ pre{margin:1rem 0;padding:3rem 1rem 1rem;overflow-x:scroll;color:#F3F9F1;background:rgba(62,60,61,1.0);position:relative;}/*!sc*/
.wuwEJ pre:before{content:' 🟠 🟡 🟢';position:absolute;display:block;background:#000;width:calc(100% + 2rem);height:2rem;line-height:2rem;-webkit-transform:translate(-1rem,-3rem);-ms-transform:translate(-1rem,-3rem);transform:translate(-1rem,-3rem);}/*!sc*/
.wuwEJ pre code{max-width:100%;font-family:Menlo,Monaco,"Courier New",monospace;color:#fff;background:transparent;font-size:.8em;}/*!sc*/
.wuwEJ a,.wuwEJ a:visited{color:#0000ff;}/*!sc*/
.wuwEJ a:hover,.wuwEJ a:focus,.wuwEJ a:active{color:#007cff;}/*!sc*/
.wuwEJ ul ul{padding:0 1.6em;}/*!sc*/
.wuwEJ ul ul ul{list-style-type:square;}/*!sc*/
.wuwEJ.retro-no-decoration{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.wuwEJ p,.wuwEJ .retro-p{margin-bottom:.6em;}/*!sc*/
.wuwEJ h1,.wuwEJ .retro-h1,.wuwEJ h2,.wuwEJ .retro-h2,.wuwEJ h3,.wuwEJ .retro-h3,.wuwEJ h4,.wuwEJ .retro-h4{margin:1.414em 0 .5em;}/*!sc*/
.wuwEJ h1,.wuwEJ .retro-h1{display:none;width:100%;text-align:center;margin-top:0;font-size:1.8em;-webkit-letter-spacing:.16em;-moz-letter-spacing:.16em;-ms-letter-spacing:.16em;letter-spacing:.16em;}/*!sc*/
.wuwEJ h2,.wuwEJ .retro-h2{font-size:1.6em;}/*!sc*/
.wuwEJ h2::after{content:'';display:block;margin:.5rem 0 1rem;width:100%;border-bottom:1px solid rgba(62,60,61,0.3);}/*!sc*/
.wuwEJ h3,.wuwEJ .retro-h3{font-size:1.2em;}/*!sc*/
.wuwEJ h4,.wuwEJ .retro-h4{font-size:1em;}/*!sc*/
.wuwEJ h5,.wuwEJ .retro-h5{font-size:.8em;}/*!sc*/
.wuwEJ h6,.wuwEJ .retro-h6{font-size:.7em;}/*!sc*/
.wuwEJ small,.wuwEJ .retro-small{font-size:.6em;}/*!sc*/
.wuwEJ blockquote{margin:1em 0;padding-left:1em;}/*!sc*/
.wuwEJ img,.wuwEJ canvas,.wuwEJ iframe,.wuwEJ video,.wuwEJ svg,.wuwEJ select,.wuwEJ textarea{max-width:100%;}/*!sc*/
.wuwEJ table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb;}/*!sc*/
.wuwEJ thead{background-color:#666666;color:#fff;vertical-align:bottom;-webkit-letter-spacing:.2em;-moz-letter-spacing:.2em;-ms-letter-spacing:.2em;letter-spacing:.2em;}/*!sc*/
.wuwEJ td,.wuwEJ th{margin:0;padding:.5em 1em;border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;overflow:visible;}/*!sc*/
.wuwEJ tr:nth-child(2n+1){background-color:transparent;}/*!sc*/
.wuwEJ tr:nth-child(2n+0){background-color:#f9f9f9;}/*!sc*/
.wuwEJ caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center;}/*!sc*/
data-styled.g68[id="Markdown__MarkdownHTMLRender-sc-17dtmth-0"]{content:"wuwEJ,"}/*!sc*/
*{margin:0;padding:0;box-sizing:border-box;background:transparent;--ant-color-success:#52c41a;--ant-color-success-hover:#73d13d;--ant-color-success-active:#389e0d;--ant-color-success-outline:rgba(82,196,26,.2);--ant-color-success-deprecated-bg:#f6ffed;--ant-color-success-deprecated-border:#b7eb8f;--ant-color-error:#ff4d4f;--ant-color-error-hover:#ff7875;--ant-color-error-active:#d9363e;--ant-color-error-outline:rgba(255,77,79,.2);--ant-color-error-deprecated-bg:#fff2f0;--ant-color-error-deprecated-border:#ffccc7;--ant-color-warning:#faad14;--ant-color-warning-hover:#ffc53d;--ant-color-warning-active:#d48806;--ant-color-warning-outline:rgba(250,173,20,.2);--ant-color-warning-deprecated-bg:#fffbe6;--ant-color-warning-deprecated-border:#ffe58f;--ant-color-info:#1890ff;--ant-color-info-outline:rgba(24,144,255,.2);--ant-color-info-deprecated-bg:#e6f7ff;--ant-color-info-deprecated-border:#91d5ff;}/*!sc*/
* .clr-primary{color:#276893;}/*!sc*/
* .clr-secondary{color:#E47542;}/*!sc*/
* .clr-blue{color:#507883;}/*!sc*/
* .clr-yellow{color:#FFB61E;}/*!sc*/
* .clr-green{color:#006E5F;}/*!sc*/
* .clr-red{color:#C03F3C;}/*!sc*/
* .clr-white{color:#F3F9F1;}/*!sc*/
* .clr-black{color:#3E3C3D;}/*!sc*/
* .clr-gold{color:#EACD76;}/*!sc*/
* .clr-link{color:#177CB0;}/*!sc*/
* .clr-grey-1{color:hsl(0,0%,10%);}/*!sc*/
* .clr-grey-2{color:hsl(0,0%,20%);}/*!sc*/
* .clr-grey-3{color:hsl(0,0%,30%);}/*!sc*/
* .clr-grey-4{color:hsl(0,0%,40%);}/*!sc*/
* .clr-grey-5{color:hsl(0,0%,50%);}/*!sc*/
* .clr-grey-6{color:hsl(0,0%,60%);}/*!sc*/
* .clr-grey-7{color:hsl(0,0%,70%);}/*!sc*/
* .clr-grey-8{color:hsl(0,0%,80%);}/*!sc*/
* .clr-grey-9{color:hsl(0,0%,90%);}/*!sc*/
* .bg-clr-primary{background-color:#276893;}/*!sc*/
* .bg-clr-secondary{background-color:#E47542;}/*!sc*/
* .bg-clr-blue{background-color:#507883;}/*!sc*/
* .bg-clr-yellow{background-color:#FFB61E;}/*!sc*/
* .bg-clr-green{background-color:#006E5F;}/*!sc*/
* .bg-clr-red{background-color:#C03F3C;}/*!sc*/
* .bg-clr-white{background-color:#F3F9F1;}/*!sc*/
* .bg-clr-black{background-color:#3E3C3D;}/*!sc*/
* .bg-clr-gold{background-color:#EACD76;}/*!sc*/
* .bg-clr-link{background-color:#177CB0;}/*!sc*/
* .bg-clr-grey-1{background-color:hsl(0,0%,10%);}/*!sc*/
* .bg-clr-grey-2{background-color:hsl(0,0%,20%);}/*!sc*/
* .bg-clr-grey-3{background-color:hsl(0,0%,30%);}/*!sc*/
* .bg-clr-grey-4{background-color:hsl(0,0%,40%);}/*!sc*/
* .bg-clr-grey-5{background-color:hsl(0,0%,50%);}/*!sc*/
* .bg-clr-grey-6{background-color:hsl(0,0%,60%);}/*!sc*/
* .bg-clr-grey-7{background-color:hsl(0,0%,70%);}/*!sc*/
* .bg-clr-grey-8{background-color:hsl(0,0%,80%);}/*!sc*/
* .bg-clr-grey-9{background-color:hsl(0,0%,90%);}/*!sc*/
* .ft-regular{font-weight:400;}/*!sc*/
* .ft-medium{font-weight:500;}/*!sc*/
* .ft-bold{font-weight:700;}/*!sc*/
* .ft-20{font-size:2em;}/*!sc*/
* .ft-15{font-size:1.5em;}/*!sc*/
* .ft-12{font-size:1.2em;}/*!sc*/
* .ft-09{font-size:.9em;}/*!sc*/
* .ft-08{font-size:.8em;}/*!sc*/
* .ft-07{font-size:.7em;}/*!sc*/
* .ft-06{font-size:.6em;}/*!sc*/
* .white-space-no-wrap{white-space:nowrap;}/*!sc*/
* .white-space-pre-wrap{white-space:pre-wrap;}/*!sc*/
* .text-indent{text-indent:2em;}/*!sc*/
* .text-align-center{text-align:center;}/*!sc*/
* .cursor-pointer{cursor:pointer;}/*!sc*/
* .relative-position{position:relative;}/*!sc*/
* .absolute-position{position:absolute;}/*!sc*/
* .z-level-100{z-index:100;}/*!sc*/
* .z-level-200{z-index:200;}/*!sc*/
* .z-level-500{z-index:500;}/*!sc*/
* .z-level-800{z-index:800;}/*!sc*/
* .ellipsis{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}/*!sc*/
* .ellipsis-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-word;}/*!sc*/
* .ellipsis-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-word;}/*!sc*/
* .full-size{width:100%;height:100%;}/*!sc*/
* .flex-start{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
* .flex-end{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}/*!sc*/
* .flex-between{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
* .flex-around{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;}/*!sc*/
* .flex-center{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
* .align-center{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
* .align-start{-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}/*!sc*/
* .align-end{-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;}/*!sc*/
* .align-stretch{-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}/*!sc*/
* .flex-wrap{-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}/*!sc*/
* .direction-reverse{-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;}/*!sc*/
* .direction-col{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
* .radius-025{border-radius:.25em;}/*!sc*/
* .radius-05{border-radius:.5em;}/*!sc*/
* .radius-1{border-radius:1em;}/*!sc*/
* .shadow01{box-shadow:0px 1px 1px rgba(0,0,0,0.14),0px 2px 1px rgba(0,0,0,0.12),0px 1px 3px rgba(0,0,0,0.2);}/*!sc*/
* .shadow02{box-shadow:0px 2px 2px rgba(0,0,0,0.14),0px 3px 1px rgba(0,0,0,0.12),0px 1px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow03{box-shadow:0px 3px 4px rgba(0,0,0,0.14),0px 3px 3px rgba(0,0,0,0.12),0px 1px 8px rgba(0,0,0,0.2);}/*!sc*/
* .shadow04{box-shadow:0px 4px 5px rgba(0,0,0,0.14),0px 1px 10px rgba(0,0,0,0.12),0px 2px 4px rgba(0,0,0,0.2);}/*!sc*/
* .shadow06{box-shadow:0px 6px 10px rgba(0,0,0,0.14),0px 1px 18px rgba(0,0,0,0.12),0px 3px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow08{box-shadow:0px 8px 10px rgba(0,0,0,0.14),0px 3px 14px rgba(0,0,0,0.12),0px 5px 5px rgba(0,0,0,0.2);}/*!sc*/
* .shadow09{box-shadow:0px 9px 12px rgba(0,0,0,0.14),0px 3px 16px rgba(0,0,0,0.12),0px 5px 6px rgba(0,0,0,0.2);}/*!sc*/
* .shadow12{box-shadow:0px 12px 17px rgba(0,0,0,0.14),0px 5px 22px rgba(0,0,0,0.12),0px 7px 8px rgba(0,0,0,0.2);}/*!sc*/
* .shadow16{box-shadow:0px 16px 24px rgba(0,0,0,0.14),0px 6px 30px rgba(0,0,0,0.12),0px 8px 10px rgba(0,0,0,0.2);}/*!sc*/
* .shadow24{box-shadow:0px 24px 38px rgba(0,0,0,0.14),0px 9px 46px rgba(0,0,0,0.12),0px 11px 15px rgba(0,0,0,0.2);}/*!sc*/
* .debug-r{border:1px solid #f00;padding:2px;}/*!sc*/
* .debug-p{border:9px solid #f0f;padding:2px;}/*!sc*/
* .debug-b{border:6px solid #00f;padding:2px;}/*!sc*/
img,iframe{loading:lazy;}/*!sc*/
h1{font-size:6em;}/*!sc*/
h2{font-size:4em;}/*!sc*/
h3{font-size:3em;}/*!sc*/
h4{font-size:2em;}/*!sc*/
h5{font-size:1.5em;}/*!sc*/
h6{font-size:1.25em;}/*!sc*/
a{color:#177CB0;}/*!sc*/
hr.style1{border-top:1px solid #8c8b8b;}/*!sc*/
hr.style2{border-top:3px double #8c8b8b;}/*!sc*/
hr.style3{border-top:1px dashed #8c8b8b;}/*!sc*/
hr.style4{border-top:1px dotted #8c8b8b;}/*!sc*/
hr.style5{background-color:#fff;border-top:2px dashed #8c8b8b;}/*!sc*/
hr.style6{background-color:#fff;border-top:2px dotted #8c8b8b;}/*!sc*/
hr.style7{border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style8{border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style8:after{content:'';display:block;margin-top:2px;border-top:1px solid #8c8b8b;border-bottom:1px solid #fff;}/*!sc*/
hr.style9{border-top:1px dashed #8c8b8b;border-bottom:1px dashed #fff;}/*!sc*/
hr.style10{border-top:1px dotted #8c8b8b;border-bottom:1px dotted #fff;}/*!sc*/
hr.style11{height:6px;background:url(http://ibrahimjabbari.com/images/hr-11.png) repeat-x 0 0;border:0;}/*!sc*/
hr.style12{height:6px;background:url(http://ibrahimjabbari.com/images/hr-12.png) repeat-x 0 0;border:0;}/*!sc*/
hr.style13{height:10px;border:0;box-shadow:0 10px 10px - 10px #8c8b8b inset;}/*!sc*/
hr.style14{border:0;height:1px;background-image:-webkit-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-moz-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-ms-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);background-image:-o-linear-gradient(left,#f0f0f0,#8c8b8b,#f0f0f0);}/*!sc*/
hr.style15{border-top:4px double #8c8b8b;text-align:center;}/*!sc*/
hr.style15:after{content:'\002665';display:inline-block;position:relative;top:-15px;padding:0 10px;background:#f0f0f0;color:#8c8b8b;font-size:36px;}/*!sc*/
hr.style16{border-top:2px dashed #8c8b8b;}/*!sc*/
hr.style16:after{content:'\002702';display:inline-block;position:relative;top:-20px;left:40px;padding:0 64px;background:#f0f0f0;color:#8c8b8b;font-size:28px;}/*!sc*/
hr.style17{border-top:2px solid #8c8b8b;text-align:center;}/*!sc*/
hr.style17:after{content:'§';display:inline-block;position:relative;top:-16px;padding:0 10px;background:#f0f0f0;color:#8c8b8b;font-size:28px;-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg);}/*!sc*/
.style18{height:30px;border-style:solid;border-color:#8c8b8b;border-width:1px 0 0 0;border-radius:20px;}/*!sc*/
hr.style18:before{display:block;content:"";height:30px;margin-top:-31px;border-style:solid;border-color:#8c8b8b;border-width:0 0 1px 0;border-radius:20px;}/*!sc*/
body{font-family:Helvetica,Tahoma,Arial,STXihei,"华文细黑",Heiti,"黑体","Microsoft YaHei","微软雅黑",SimSun,"宋体",sans-serif;font-size:16px;color:#3E3C3D;}/*!sc*/
data-styled.g71[id="sc-global-iFKloc1"]{content:"sc-global-iFKloc1,"}/*!sc*/
.TUexl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;gap:1rem;position:relative;}/*!sc*/
@media screen and (max-width:767px){.TUexl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}}/*!sc*/
data-styled.g79[id="blog__BodyContainer-sc-1pczva4-0"]{content:"TUexl,"}/*!sc*/
.dGDPjr{background-color:#fff;border-radius:8px;padding:1rem;}/*!sc*/
data-styled.g80[id="blog__Card-sc-1pczva4-1"]{content:"dGDPjr,"}/*!sc*/
.fdKA-DO{text-align:center;padding:0 0 1rem;border-bottom:1px solid rgba(62,60,61,0.3);}/*!sc*/
.fdKA-DO h1{font-size:2.5rem;line-height:5rem;}/*!sc*/
data-styled.g81[id="blog__BlogHeaderArea-sc-1pczva4-2"]{content:"fdKA-DO,"}/*!sc*/
.gVCmfB{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:.5rem;color:rgba(39,104,147,0.8);-webkit-text-decoration:underline;text-decoration:underline;font-size:.8rem;}/*!sc*/
.gVCmfB span{cursor:pointer;}/*!sc*/
data-styled.g82[id="blog__TagContainer-sc-1pczva4-3"]{content:"gVCmfB,"}/*!sc*/
</style><title data-react-helmet="true">WeReady</title><link as="script" rel="preload" href="/webpack-runtime-fdcbf6b17242e324ca08.js"/><link as="script" rel="preload" href="/framework-7818d66ac74a4e73b7d9.js"/><link as="script" rel="preload" href="/app-85ab217213fbdd0955c7.js"/><link as="script" rel="preload" href="/commons-25c08ee1fa984e3c32d5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-js-c289ae42e4b930074676.js"/><link as="fetch" rel="preload" href="/page-data/blog/20210130002_frp/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1280648994.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3159585216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><section height="4rem" color="#F3F9F1" class="Layout__Section-sc-1bdq7wd-3 cRFnth relative-position z-level-800"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><div class="Common__Container-sc-qqf9b1-0 eSCfig flex-between align-center" height="4rem"><div class="Common__Container-sc-qqf9b1-0 hpfWsV debugx"><a class="Link__Container-sc-zcsev2-0 gttqhR" href="/"><h4>📜</h4></a></div><div class="Common__Container-sc-qqf9b1-0 eHike debugx" style="flex:1;height:100%" color="#F3F9F1"><div class="Herizon__Container-sc-1o23vw7-0 ggvQtb"><ul style="gap:1em" class="flex-center debugx"><li class="Herizon__ListItem-sc-1o23vw7-1 irUIDe debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/">Blog</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 irUIDe debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx bottom"><p>Library</p></div><ul><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx right"><p><a href="/uispec">Spec</a></p></div><ul><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/typography">Typography</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/color">Color</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/shape">Shape</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/shadow">Shadow</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/layers">Layers</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/layout">Layout</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/divider">Divider</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/cssborder">Border</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/uispec/svgicons">Icon</a></p></div></li></ul></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx right"><p><a href="/hook">Hook</a></p></div><ul><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/hook/timer">Timer</a></p></div></li></ul></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx right"><p><a href="/component">Components</a></p></div><ul><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/button">Button</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/tag">Tags</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/link">Link</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/highlight">Highlight</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/image">Image</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/indicator">Indicator</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/carousel">Carousel</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/list?id=10">List</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/component/modal?variant=dialog">Modal</a></p></div></li></ul></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx right"><p><a href="/form">Form</a></p></div><ul><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/demo1">Demo#1</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/demo2">Demo#2</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/demo3">Demo#3</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/demo4">Demo#4</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/login">Login</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/reset">Reset</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/object">Object</a></p></div></li><li class="Herizon__ListItem-sc-1o23vw7-1 pWylq debugx"><div class="Herizon__ItemContent-sc-1o23vw7-2 dmaeiV flex-start align-center debugx"><p><a href="/form/choice">Choice</a></p></div></li></ul></li></ul></li></ul></div></div><h4>😊</h4></div></div></section><section style="min-height:100vh" class="Layout__Section-sc-1bdq7wd-3 eJzqUT"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><div class="Common__Container-sc-qqf9b1-0 blog__BodyContainer-sc-1pczva4-0 hpfWsV TUexl"><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 hpfWsV dGDPjr debugx" style="flex:1"><div class="Common__Container-sc-qqf9b1-0 blog__BlogHeaderArea-sc-1pczva4-2 gixjse fdKA-DO"><h1>通过 frp 实现内网穿透</h1><p class="ft-0.9" style="color:rgba(62, 60, 61, 0.6)"><span>作者：</span><span style="color:#E47542">Chris Wei</span>    <span>时间：</span><span style="color:#E47542">2021-01-30</span>    <span>分类：</span><span style="color:#E47542">指导手册</span></p></div><div class="Markdown__MarkdownHTMLRender-sc-17dtmth-0 wuwEJ"><h1>通过 frp 实现内网穿透</h1>
<h2>Install Server Side Service</h2>
<pre><code>wget https://github.com/fatedier/frp/releases/download/v0.32.0/frp_0.32.0_linux_amd64.tar.gz
</code></pre>
<pre><code>tar -zxvf frp_0.32.0_linux_amd64.tar.gz
</code></pre>
<pre><code>cd frp_0.32.0_linux_amd64
cp frps.ini frps.bak
vi frps.ini
</code></pre>
<pre><code># frps.ini
[common]
bind_port = 7000
vhost_http_port = 80
</code></pre>
<pre><code>vi start.sh
</code></pre>
<pre><code>#!/bin/bash
# start frp service

./frps -c ./frps.ini
</code></pre>
<h2>Start frp Service</h2>
<pre><code>sh start.sh
</code></pre>
<h2>Install Client Side Application</h2>
<ul>
<li>download <code>https://github.com/fatedier/frp/releases/download/v0.32.0/frp_0.32.0_windows_amd64.zip</code></li>
<li>unzip</li>
<li>backup frpc.ini ==>> frpc.bak</li>
</ul>
<h2>Config</h2>
<pre><code># frpc.ini
[common]
server_addr = x.x.x.x                   # server IP
server_port = 7000

[web]
type = http
local_port = 3000
custom_domains = www.yourdomain.com     # domain
</code></pre>
<h2>Start Client</h2>
<blockquote>
<p>save as bat file</p>
</blockquote>
<pre><code>frpc -c frpc.ini
</code></pre>
<h2>---------------- 分割线 以下是 2020-03-17 时的快照 ------------------------------------</h2>
<p>内容来自 <a href="https://github.com/fatedier/frp">frp</a> 的 <a href="https://github.com/fatedier/frp/blob/master/README_zh.md">readme</a> 文档。</p>
<h2>frp</h2>
<p><a href="https://travis-ci.org/fatedier/frp"><img src="https://travis-ci.org/fatedier/frp.svg?branch=master" alt="Build Status"></a></p>
<p><a href="README.md">README</a> | <a href="README_zh.md">中文文档</a></p>
<p>frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。</p>
<h3>目录</h3>
<!-- vim-markdown-toc GFM -->
<ul>
<li><a href="#%E5%BC%80%E5%8F%91%E7%8A%B6%E6%80%81">开发状态</a></li>
<li><a href="#%E6%9E%B6%E6%9E%84">架构</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">使用示例</a>
<ul>
<li><a href="#%E9%80%9A%E8%BF%87-ssh-%E8%AE%BF%E9%97%AE%E5%85%AC%E5%8F%B8%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">通过 ssh 访问公司内网机器</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E9%83%A8%E7%BD%B2%E4%BA%8E%E5%86%85%E7%BD%91%E7%9A%84-web-%E6%9C%8D%E5%8A%A1">通过自定义域名访问部署于内网的 web 服务</a></li>
<li><a href="#%E8%BD%AC%E5%8F%91-dns-%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82">转发 DNS 查询请求</a></li>
<li><a href="#%E8%BD%AC%E5%8F%91-unix-%E5%9F%9F%E5%A5%97%E6%8E%A5%E5%AD%97">转发 Unix 域套接字</a></li>
<li><a href="#%E5%AF%B9%E5%A4%96%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1">对外提供简单的文件访问服务</a></li>
<li><a href="#%E4%B8%BA%E6%9C%AC%E5%9C%B0-http-%E6%9C%8D%E5%8A%A1%E5%90%AF%E7%94%A8-https">为本地 HTTP 服务启用 HTTPS</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E5%9C%B0%E6%9A%B4%E9%9C%B2%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1">安全地暴露内网服务</a></li>
<li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F">点对点内网穿透</a></li>
</ul>
</li>
<li><a href="#%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E">功能说明</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">配置文件</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A8%A1%E7%89%88%E6%B8%B2%E6%9F%93">配置文件模版渲染</a></li>
<li><a href="#dashboard">Dashboard</a></li>
<li><a href="#admin-ui">Admin UI</a></li>
<li><a href="#%E7%9B%91%E6%8E%A7">监控</a>
<ul>
<li><a href="#prometheus">Prometheus</a></li>
</ul>
</li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81">客户端身份验证</a>
<ul>
<li><a href="#token">Token</a></li>
<li><a href="#oidc">OIDC</a></li>
</ul>
</li>
<li><a href="#%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%8E%8B%E7%BC%A9">加密与压缩</a>
<ul>
<li><a href="#tls">TLS</a></li>
</ul>
</li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%83%AD%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">客户端热加载配置文件</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%90%86%E7%8A%B6%E6%80%81">客户端查看代理状态</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E7%99%BD%E5%90%8D%E5%8D%95">端口白名单</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8">端口复用</a></li>
<li><a href="#%E9%99%90%E9%80%9F">限速</a>
<ul>
<li><a href="#%E4%BB%A3%E7%90%86%E9%99%90%E9%80%9F">代理限速</a></li>
</ul>
</li>
<li><a href="#tcp-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8">TCP 多路复用</a></li>
<li><a href="#%E5%BA%95%E5%B1%82%E9%80%9A%E4%BF%A1%E5%8F%AF%E9%80%89-kcp-%E5%8D%8F%E8%AE%AE">底层通信可选 kcp 协议</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0">连接池</a></li>
<li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">负载均衡</a></li>
<li><a href="#%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5">健康检查</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9-host-header">修改 Host Header</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE-http-%E8%AF%B7%E6%B1%82%E7%9A%84-header">设置 HTTP 请求的 header</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%9C%9F%E5%AE%9E-ip">获取用户真实 IP</a>
<ul>
<li><a href="#http-x-forwarded-for">HTTP X-Forwarded-For</a></li>
<li><a href="#proxy-protocol">Proxy Protocol</a></li>
</ul>
</li>
<li><a href="#%E9%80%9A%E8%BF%87%E5%AF%86%E7%A0%81%E4%BF%9D%E6%8A%A4%E4%BD%A0%E7%9A%84-web-%E6%9C%8D%E5%8A%A1">通过密码保护你的 web 服务</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D">自定义二级域名</a></li>
<li><a href="#url-%E8%B7%AF%E7%94%B1">URL 路由</a></li>
<li><a href="#tcp-%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8%E7%B1%BB%E5%9E%8B">TCP 端口复用类型</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5-frps">通过代理连接 frps</a></li>
<li><a href="#%E8%8C%83%E5%9B%B4%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84">范围端口映射</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8F%92%E4%BB%B6">客户端插件</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AE%A1%E7%90%86%E6%8F%92%E4%BB%B6">服务端管理插件</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92">开发计划</a></li>
<li><a href="#%E4%B8%BA-frp-%E5%81%9A%E8%B4%A1%E7%8C%AE">为 frp 做贡献</a></li>
<li><a href="#%E6%8D%90%E5%8A%A9">捐助</a>
<ul>
<li><a href="#%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83">知识星球</a></li>
<li><a href="#%E6%94%AF%E4%BB%98%E5%AE%9D%E6%89%AB%E7%A0%81%E6%8D%90%E8%B5%A0">支付宝扫码捐赠</a></li>
<li><a href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%8D%90%E8%B5%A0">微信支付捐赠</a></li>
<li><a href="#paypal-%E6%8D%90%E8%B5%A0">Paypal 捐赠</a></li>
</ul>
</li>
</ul>
<!-- vim-markdown-toc -->
<h3>开发状态</h3>
<p>frp 仍然处于开发阶段，未经充分测试与验证，不推荐用于生产环境。</p>
<p>master 分支用于发布稳定版本，dev 分支用于开发，您可以尝试下载最新的 release 版本进行测试。</p>
<p><strong>目前的交互协议可能随时改变，不保证向后兼容，升级新版本时需要注意公告说明同时升级服务端和客户端。</strong></p>
<h3>架构</h3>
<p><img src="/doc/pic/architecture.png" alt="architecture"></p>
<h3>使用示例</h3>
<p>根据对应的操作系统及架构，从 <a href="https://github.com/fatedier/frp/releases">Release</a> 页面下载最新版本的程序。</p>
<p>将 <strong>frps</strong> 及 <strong>frps.ini</strong> 放到具有公网 IP 的机器上。</p>
<p>将 <strong>frpc</strong> 及 <strong>frpc.ini</strong> 放到处于内网环境的机器上。</p>
<h4>通过 ssh 访问公司内网机器</h4>
<ol>
<li>修改 frps.ini 文件，这里使用了最简化的配置：</li>
</ol>
<pre><code class="language-ini"># frps.ini
[common]
bind_port = 7000
</code></pre>
<ol start="2">
<li>启动 frps：</li>
</ol>
<p><code>./frps -c ./frps.ini</code></p>
<ol start="3">
<li>修改 frpc.ini 文件，假设 frps 所在服务器的公网 IP 为 x.x.x.x；</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
</code></pre>
<ol start="4">
<li>启动 frpc：</li>
</ol>
<p><code>./frpc -c ./frpc.ini</code></p>
<ol start="5">
<li>通过 ssh 访问内网机器，假设用户名为 test：</li>
</ol>
<p><code>ssh -oPort=6000 test@x.x.x.x</code></p>
<h4>通过自定义域名访问部署于内网的 web 服务</h4>
<p>有时想要让其他人通过域名访问或者测试我们在本地搭建的 web 服务，但是由于本地机器没有公网 IP，无法将域名解析到本地的机器，通过 frp 就可以实现这一功能，以下示例为 http 服务，https 服务配置方法相同， vhost_http_port 替换为 vhost_https_port， type 设置为 https 即可。</p>
<ol>
<li>修改 frps.ini 文件，设置 http 访问端口为 8080：</li>
</ol>
<pre><code class="language-ini"># frps.ini
[common]
bind_port = 7000
vhost_http_port = 8080
</code></pre>
<ol start="2">
<li>启动 frps：</li>
</ol>
<p><code>./frps -c ./frps.ini</code></p>
<ol start="3">
<li>修改 frpc.ini 文件，假设 frps 所在的服务器的 IP 为 x.x.x.x，local_port 为本地机器上 web 服务对应的端口, 绑定自定义域名 <code>www.yourdomain.com</code>:</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[web]
type = http
local_port = 80
custom_domains = www.yourdomain.com
</code></pre>
<ol start="4">
<li>启动 frpc：</li>
</ol>
<p><code>./frpc -c ./frpc.ini</code></p>
<ol start="5">
<li>
<p>将 <code>www.yourdomain.com</code> 的域名 A 记录解析到 IP <code>x.x.x.x</code>，如果服务器已经有对应的域名，也可以将 CNAME 记录解析到服务器原先的域名。</p>
</li>
<li>
<p>通过浏览器访问 <code>http://www.yourdomain.com:8080</code> 即可访问到处于内网机器上的 web 服务。</p>
</li>
</ol>
<h4>转发 DNS 查询请求</h4>
<p>DNS 查询请求通常使用 UDP 协议，frp 支持对内网 UDP 服务的穿透，配置方式和 TCP 基本一致。</p>
<ol>
<li>修改 frps.ini 文件：</li>
</ol>
<pre><code class="language-ini"># frps.ini
[common]
bind_port = 7000
</code></pre>
<ol start="2">
<li>启动 frps：</li>
</ol>
<p><code>./frps -c ./frps.ini</code></p>
<ol start="3">
<li>修改 frpc.ini 文件，设置 frps 所在服务器的 IP 为 x.x.x.x，转发到 Google 的 DNS 查询服务器 <code>8.8.8.8</code> 的 udp 53 端口：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[dns]
type = udp
local_ip = 8.8.8.8
local_port = 53
remote_port = 6000
</code></pre>
<ol start="4">
<li>启动 frpc：</li>
</ol>
<p><code>./frpc -c ./frpc.ini</code></p>
<ol start="5">
<li>通过 dig 测试 UDP 包转发是否成功，预期会返回 <code>www.google.com</code> 域名的解析结果：</li>
</ol>
<p><code>dig @x.x.x.x -p 6000 www.google.com</code></p>
<h4>转发 Unix 域套接字</h4>
<p>通过 tcp 端口访问内网的 unix域套接字(例如和 docker daemon 通信)。</p>
<p>frps 的部署步骤同上。</p>
<ol>
<li>启动 frpc，启用 <code>unix_domain_socket</code> 插件，配置如下：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[unix_domain_socket]
type = tcp
remote_port = 6000
plugin = unix_domain_socket
plugin_unix_path = /var/run/docker.sock
</code></pre>
<ol start="2">
<li>通过 curl 命令查看 docker 版本信息</li>
</ol>
<p><code>curl http://x.x.x.x:6000/version</code></p>
<h4>对外提供简单的文件访问服务</h4>
<p>通过 <code>static_file</code> 插件可以对外提供一个简单的基于 HTTP 的文件访问服务。</p>
<p>frps 的部署步骤同上。</p>
<ol>
<li>启动 frpc，启用 <code>static_file</code> 插件，配置如下：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[test_static_file]
type = tcp
remote_port = 6000
plugin = static_file
# 要对外暴露的文件目录
plugin_local_path = /tmp/file
# 访问 url 中会被去除的前缀，保留的内容即为要访问的文件路径
plugin_strip_prefix = static
plugin_http_user = abc
plugin_http_passwd = abc
</code></pre>
<ol start="2">
<li>通过浏览器访问 <code>http://x.x.x.x:6000/static/</code> 来查看位于 <code>/tmp/file</code> 目录下的文件，会要求输入已设置好的用户名和密码。</li>
</ol>
<h4>为本地 HTTP 服务启用 HTTPS</h4>
<p>通过 <code>https2http</code> 插件可以让本地 HTTP 服务转换成 HTTPS 服务对外提供。</p>
<ol>
<li>启用 frpc，启用 <code>https2http</code> 插件，配置如下:</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[test_htts2http]
type = https
custom_domains = test.yourdomain.com

plugin = https2http
plugin_local_addr = 127.0.0.1:80

# HTTPS 证书相关的配置
plugin_crt_path = ./server.crt
plugin_key_path = ./server.key
plugin_host_header_rewrite = 127.0.0.1
plugin_header_X-From-Where = frp
</code></pre>
<ol start="2">
<li>通过浏览器访问 <code>https://test.yourdomain.com</code> 即可。</li>
</ol>
<h4>安全地暴露内网服务</h4>
<p>对于某些服务来说如果直接暴露于公网上将会存在安全隐患。</p>
<p>使用 <strong>stcp(secret tcp)</strong> 类型的代理可以避免让任何人都能访问到要穿透的服务，但是访问者也需要运行另外一个 frpc。</p>
<p>以下示例将会创建一个只有自己能访问到的 ssh 服务代理。</p>
<p>frps 的部署步骤同上。</p>
<ol>
<li>启动 frpc，转发内网的 ssh 服务，配置如下，不需要指定远程端口：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[secret_ssh]
type = stcp
# 只有 sk 一致的用户才能访问到此服务
sk = abcdefg
local_ip = 127.0.0.1
local_port = 22
</code></pre>
<ol start="2">
<li>在要访问这个服务的机器上启动另外一个 frpc，配置如下：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[secret_ssh_visitor]
type = stcp
# stcp 的访问者
role = visitor
# 要访问的 stcp 代理的名字
server_name = secret_ssh
sk = abcdefg
# 绑定本地端口用于访问 ssh 服务
bind_addr = 127.0.0.1
bind_port = 6000
</code></pre>
<ol start="3">
<li>通过 ssh 访问内网机器，假设用户名为 test：</li>
</ol>
<p><code>ssh -oPort=6000 test@127.0.0.1</code></p>
<h4>点对点内网穿透</h4>
<p>frp 提供了一种新的代理类型 <strong>xtcp</strong> 用于应对在希望传输大量数据且流量不经过服务器的场景。</p>
<p>使用方式同 <strong>stcp</strong> 类似，需要在两边都部署上 frpc 用于建立直接的连接。</p>
<p>目前处于开发的初级阶段，并不能穿透所有类型的 NAT 设备，所以穿透成功率较低。穿透失败时可以尝试 <strong>stcp</strong> 的方式。</p>
<ol>
<li>frps 除正常配置外需要额外配置一个 udp 端口用于支持该类型的客户端:</li>
</ol>
<pre><code class="language-ini">bind_udp_port = 7001
</code></pre>
<ol start="2">
<li>启动 frpc，转发内网的 ssh 服务，配置如下，不需要指定远程端口:</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[p2p_ssh]
type = xtcp
# 只有 sk 一致的用户才能访问到此服务
sk = abcdefg
local_ip = 127.0.0.1
local_port = 22
</code></pre>
<ol start="3">
<li>在要访问这个服务的机器上启动另外一个 frpc，配置如下:</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[p2p_ssh_visitor]
type = xtcp
# xtcp 的访问者
role = visitor
# 要访问的 xtcp 代理的名字
server_name = p2p_ssh
sk = abcdefg
# 绑定本地端口用于访问 ssh 服务
bind_addr = 127.0.0.1
bind_port = 6000
</code></pre>
<ol start="4">
<li>通过 ssh 访问内网机器，假设用户名为 test:</li>
</ol>
<p><code>ssh -oPort=6000 test@127.0.0.1</code></p>
<h3>功能说明</h3>
<h4>配置文件</h4>
<p>由于 frp 目前支持的功能和配置项较多，未在文档中列出的功能可以从完整的示例配置文件中发现。</p>
<p><a href="./conf/frps_full.ini">frps 完整配置文件</a></p>
<p><a href="./conf/frpc_full.ini">frpc 完整配置文件</a></p>
<h4>配置文件模版渲染</h4>
<p>配置文件支持使用系统环境变量进行模版渲染，模版格式采用 Go 的标准格式。</p>
<p>示例配置如下:</p>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = {{ .Envs.FRP_SERVER_ADDR }}
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = {{ .Envs.FRP_SSH_REMOTE_PORT }}
</code></pre>
<p>启动 frpc 程序:</p>
<pre><code>export FRP_SERVER_ADDR="x.x.x.x"
export FRP_SSH_REMOTE_PORT="6000"
./frpc -c ./frpc.ini
</code></pre>
<p>frpc 会自动使用环境变量渲染配置文件模版，所有环境变量需要以 <code>.Envs</code> 为前缀。</p>
<h4>Dashboard</h4>
<p>通过浏览器查看 frp 的状态以及代理统计信息展示。</p>
<p><strong>注：Dashboard 尚未针对大量的 proxy 数据展示做优化，如果出现 Dashboard 访问较慢的情况，请不要启用此功能。</strong></p>
<p>需要在 frps.ini 中指定 dashboard 服务使用的端口，即可开启此功能：</p>
<pre><code class="language-ini">[common]
dashboard_port = 7500
# dashboard 用户名密码，默认都为 admin
dashboard_user = admin
dashboard_pwd = admin
</code></pre>
<p>打开浏览器通过 <code>http://[server_addr]:7500</code> 访问 dashboard 界面，用户名密码默认为 <code>admin</code>。</p>
<p><img src="/doc/pic/dashboard.png" alt="dashboard"></p>
<h4>Admin UI</h4>
<p>Admin UI 可以帮助用户通过浏览器来查询和管理客户端的 proxy 状态和配置。</p>
<p>需要在 frpc.ini 中指定 admin 服务使用的端口，即可开启此功能：</p>
<pre><code class="language-ini">[common]
admin_addr = 127.0.0.1
admin_port = 7400
admin_user = admin
admin_pwd = admin
</code></pre>
<p>打开浏览器通过 <code>http://127.0.0.1:7400</code> 访问 Admin UI，用户名密码默认为 <code>admin</code>。</p>
<p>如果想要在外网环境访问 Admin UI，将 7400 端口映射出去即可，但需要重视安全风险。</p>
<h4>监控</h4>
<p>frps 当启用 Dashboard 后，会默认开启内部的监控，数据存放在内存中，每次重启进程后会清空，监控数据可以通过 dashboard 的地址发送 HTTP 请求获取。</p>
<p>目前还支持 Prometheus 作为可选的监控系统。</p>
<h5>Prometheus</h5>
<p>在 <code>frps.ini</code> 中启用 Dashboard，并且设置 <code>enable_prometheus = true</code>，则通过 <code>http://{dashboard_addr}/metrics</code> 可以获取到 Prometheus 的监控数据。</p>
<h4>客户端身份验证</h4>
<p>目前 frpc 和 frps 之间支持两种身份验证方式，<code>token</code> 和 <code>oidc</code>。</p>
<p>通过 <code>frpc.ini</code> 和 <code>frps.ini</code> 中 <code>[common]</code> section 的 <code>authentication_method</code> 参数配置需要使用的验证方法。</p>
<p><code>authenticate_heartbeats = true</code> 将会在每一个心跳包中附加上鉴权信息。</p>
<p><code>authenticate_new_work_conns = true</code> 将会在每次建立新的工作连接时附加上鉴权信息。</p>
<h5>Token</h5>
<p>当 <code>authentication_method = token</code>，将会启用基于 token 的验证方式。</p>
<p>需要在 <code>frpc.ini</code> 和 <code>frps.ini</code> 的 <code>[common]</code> section 中设置相同的 <code>token</code>。</p>
<h5>OIDC</h5>
<p>当 <code>authentication_method = oidc</code>，将会启用基于 OIDC 的身份验证。</p>
<p>验证流程参考 <a href="https://tools.ietf.org/html/rfc6749#section-4.4">Client Credentials Grant</a></p>
<p>启用这一验证方式，配置 <code>frpc.ini</code> 和 <code>frps.ini</code> 如下：</p>
<pre><code class="language-ini"># frps.ini
[common]
authentication_method = oidc
oidc_issuer = https://example-oidc-issuer.com/
oidc_audience = https://oidc-audience.com/.default
</code></pre>
<pre><code class="language-ini">[common]
authentication_method = oidc
oidc_client_id = 98692467-37de-409a-9fac-bb2585826f18 # Replace with OIDC client ID
oidc_client_secret = oidc_secret
oidc_audience = https://oidc-audience.com/.default
oidc_token_endpoint_url = https://example-oidc-endpoint.com/oauth2/v2.0/token
</code></pre>
<h4>加密与压缩</h4>
<p>这两个功能默认是不开启的，需要在 frpc.ini 中通过配置来为指定的代理启用加密与压缩的功能，压缩算法使用 snappy：</p>
<pre><code class="language-ini"># frpc.ini
[ssh]
type = tcp
local_port = 22
remote_port = 6000
use_encryption = true
use_compression = true
</code></pre>
<p>如果公司内网防火墙对外网访问进行了流量识别与屏蔽，例如禁止了 ssh 协议等，通过设置 <code>use_encryption = true</code>，将 frpc 与 frps 之间的通信内容加密传输，将会有效防止流量被拦截。</p>
<p>如果传输的报文长度较长，通过设置 <code>use_compression = true</code> 对传输内容进行压缩，可以有效减小 frpc 与 frps 之间的网络流量，加快流量转发速度，但是会额外消耗一些 cpu 资源。</p>
<h5>TLS</h5>
<p>从 v0.25.0 版本开始 frpc 和 frps 之间支持通过 TLS 协议加密传输。通过在 <code>frpc.ini</code> 的 <code>common</code> 中配置 <code>tls_enable = true</code> 来启用此功能，安全性更高。</p>
<p>为了端口复用，frp 建立 TLS 连接的第一个字节为 0x17。</p>
<p>通过将 frps.ini 的 <code>[common]</code> 中 <code>tls_only</code> 设置为 true，可以强制 frps 只接受 TLS 连接。</p>
<p><strong>注意: 启用此功能后除 xtcp 外，不需要再设置 use_encryption。</strong></p>
<h4>客户端热加载配置文件</h4>
<p>当修改了 frpc 中的代理配置，可以通过 <code>frpc reload</code> 命令来动态加载配置文件，通常会在 10 秒内完成代理的更新。</p>
<p>启用此功能需要在 frpc 中启用 admin 端口，用于提供 API 服务。配置如下：</p>
<pre><code class="language-ini"># frpc.ini
[common]
admin_addr = 127.0.0.1
admin_port = 7400
</code></pre>
<p>之后执行重启命令：</p>
<p><code>frpc reload -c ./frpc.ini</code></p>
<p>等待一段时间后客户端会根据新的配置文件创建、更新、删除代理。</p>
<p><strong>需要注意的是，[common] 中的参数除了 start 外目前无法被修改。</strong></p>
<h4>客户端查看代理状态</h4>
<p>frpc 支持通过 <code>frpc status -c ./frpc.ini</code> 命令查看代理的状态信息，此功能需要在 frpc 中配置 admin 端口。</p>
<h4>端口白名单</h4>
<p>为了防止端口被滥用，可以手动指定允许哪些端口被使用，在 frps.ini 中通过 <code>allow_ports</code> 来指定：</p>
<pre><code class="language-ini"># frps.ini
[common]
allow_ports = 2000-3000,3001,3003,4000-50000
</code></pre>
<p><code>allow_ports</code> 可以配置允许使用的某个指定端口或者是一个范围内的所有端口，以 <code>,</code> 分隔，指定的范围以 <code>-</code> 分隔。</p>
<h4>端口复用</h4>
<p>目前 frps 中的 <code>vhost_http_port</code> 和 <code>vhost_https_port</code> 支持配置成和 <code>bind_port</code> 为同一个端口，frps 会对连接的协议进行分析，之后进行不同的处理。</p>
<p>例如在某些限制较严格的网络环境中，可以将 <code>bind_port</code> 和 <code>vhost_https_port</code> 都设置为 443。</p>
<p>后续会尝试允许多个 proxy 绑定同一个远端端口的不同协议。</p>
<h4>限速</h4>
<h5>代理限速</h5>
<p>目前支持在客户端的代理配置中设置代理级别的限速，限制单个 proxy 可以占用的带宽。</p>
<pre><code class="language-ini"># frpc.ini
[ssh]
type = tcp
local_port = 22
remote_port = 6000
bandwidth_limit = 1MB
</code></pre>
<p>在代理配置中增加 <code>bandwidth_limit</code> 字段启用此功能，目前仅支持 <code>MB</code> 和 <code>KB</code> 单位。</p>
<h4>TCP 多路复用</h4>
<p>从 v0.10.0 版本开始，客户端和服务器端之间的连接支持多路复用，不再需要为每一个用户请求创建一个连接，使连接建立的延迟降低，并且避免了大量文件描述符的占用，使 frp 可以承载更高的并发数。</p>
<p>该功能默认启用，如需关闭，可以在 frps.ini 和 frpc.ini 中配置，该配置项在服务端和客户端必须一致：</p>
<pre><code class="language-ini"># frps.ini 和 frpc.ini 中
[common]
tcp_mux = false
</code></pre>
<h4>底层通信可选 kcp 协议</h4>
<p>底层通信协议支持选择 kcp 协议，在弱网环境下传输效率提升明显，但是会有一些额外的流量消耗。</p>
<p>开启 kcp 协议支持：</p>
<ol>
<li>在 frps.ini 中启用 kcp 协议支持，指定一个 udp 端口用于接收客户端请求：</li>
</ol>
<pre><code class="language-ini"># frps.ini
[common]
bind_port = 7000
# kcp 绑定的是 udp 端口，可以和 bind_port 一样
kcp_bind_port = 7000
</code></pre>
<ol start="2">
<li>在 frpc.ini 指定需要使用的协议类型，目前只支持 tcp 和 kcp。其他代理配置不需要变更：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
# server_port 指定为 frps 的 kcp_bind_port
server_port = 7000
protocol = kcp
</code></pre>
<ol start="3">
<li>像之前一样使用 frp，需要注意开放相关机器上的 udp 的端口的访问权限。</li>
</ol>
<h4>连接池</h4>
<p>默认情况下，当用户请求建立连接后，frps 才会请求 frpc 主动与后端服务建立一个连接。当为指定的代理启用连接池后，frp 会预先和后端服务建立起指定数量的连接，每次接收到用户请求后，会从连接池中取出一个连接和用户连接关联起来，避免了等待与后端服务建立连接以及 frpc 和 frps 之间传递控制信息的时间。</p>
<p>这一功能比较适合有大量短连接请求时开启。</p>
<ol>
<li>首先可以在 frps.ini 中设置每个代理可以创建的连接池上限，避免大量资源占用，客户端设置超过此配置后会被调整到当前值：</li>
</ol>
<pre><code class="language-ini"># frps.ini
[common]
max_pool_count = 5
</code></pre>
<ol start="2">
<li>在 frpc.ini 中为客户端启用连接池，指定预创建连接的数量：</li>
</ol>
<pre><code class="language-ini"># frpc.ini
[common]
pool_count = 1
</code></pre>
<h4>负载均衡</h4>
<p>可以将多个相同类型的 proxy 加入到同一个 group 中，从而实现负载均衡的功能。</p>
<p>目前只支持 TCP 和 HTTP 类型的 proxy。</p>
<pre><code class="language-ini"># frpc.ini
[test1]
type = tcp
local_port = 8080
remote_port = 80
group = web
group_key = 123

[test2]
type = tcp
local_port = 8081
remote_port = 80
group = web
group_key = 123
</code></pre>
<p>用户连接 frps 服务器的 80 端口，frps 会将接收到的用户连接随机分发给其中一个存活的 proxy。这样可以在一台 frpc 机器挂掉后仍然有其他节点能够提供服务。</p>
<p>TCP 类型代理要求 <code>group_key</code> 相同，做权限验证，且 <code>remote_port</code> 相同。</p>
<p>HTTP 类型代理要求 <code>group_key, custom_domains 或 subdomain 和 locations</code> 相同。</p>
<h4>健康检查</h4>
<p>通过给 proxy 加上健康检查的功能，可以在要反向代理的服务出现故障时，将这个服务从 frps 中摘除，搭配负载均衡的功能，可以用来实现高可用的架构，避免服务单点故障。</p>
<p>在每一个 proxy 的配置下加上 <code>health_check_type = {type}</code> 来启用健康检查功能。</p>
<p><strong>type</strong> 目前可选 tcp 和 http。</p>
<p>tcp 只要能够建立连接则认为服务正常，http 会发送一个 http 请求，服务需要返回 2xx 的状态码才会被认为正常。</p>
<p>tcp 示例配置如下：</p>
<pre><code class="language-ini"># frpc.ini
[test1]
type = tcp
local_port = 22
remote_port = 6000
# 启用健康检查，类型为 tcp
health_check_type = tcp
# 建立连接超时时间为 3 秒
health_check_timeout_s = 3
# 连续 3 次检查失败，此 proxy 会被摘除
health_check_max_failed = 3
# 每隔 10 秒进行一次健康检查
health_check_interval_s = 10
</code></pre>
<p>http 示例配置如下：</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = http
local_ip = 127.0.0.1
local_port = 80
custom_domains = test.yourdomain.com
# 启用健康检查，类型为 http
health_check_type = http
# 健康检查发送 http 请求的 url，后端服务需要返回 2xx 的 http 状态码
health_check_url = /status
health_check_interval_s = 10
health_check_max_failed = 3
health_check_timeout_s = 3
</code></pre>
<h4>修改 Host Header</h4>
<p>通常情况下 frp 不会修改转发的任何数据。但有一些后端服务会根据 http 请求 header 中的 host 字段来展现不同的网站，例如 nginx 的虚拟主机服务，启用 host-header 的修改功能可以动态修改 http 请求中的 host 字段。该功能仅限于 http 类型的代理。</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = http
local_port = 80
custom_domains = test.yourdomain.com
host_header_rewrite = dev.yourdomain.com
</code></pre>
<p>原来 http 请求中的 host 字段 <code>test.yourdomain.com</code> 转发到后端服务时会被替换为 <code>dev.yourdomain.com</code>。</p>
<h4>设置 HTTP 请求的 header</h4>
<p>对于 <code>type = http</code> 的代理，可以设置在转发中动态添加的 header 参数。</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = http
local_port = 80
custom_domains = test.yourdomain.com
host_header_rewrite = dev.yourdomain.com
header_X-From-Where = frp
</code></pre>
<p>对于参数配置中所有以 <code>header_</code> 开头的参数(支持同时配置多个)，都会被添加到 http 请求的 header 中，根据如上的配置，会在请求的 header 中加上 <code>X-From-Where: frp</code>。</p>
<h4>获取用户真实 IP</h4>
<h5>HTTP X-Forwarded-For</h5>
<p>目前只有 <strong>http</strong> 类型的代理支持这一功能，可以通过用户请求的 header 中的 <code>X-Forwarded-For</code> 来获取用户真实 IP，默认启用。</p>
<h5>Proxy Protocol</h5>
<p>frp 支持通过 <strong>Proxy Protocol</strong> 协议来传递经过 frp 代理的请求的真实 IP，此功能支持所有以 TCP 为底层协议的类型，不支持 UDP。</p>
<p><strong>Proxy Protocol</strong> 功能启用后，frpc 在和本地服务建立连接后，会先发送一段 <strong>Proxy Protocol</strong> 的协议内容给本地服务，本地服务通过解析这一内容可以获得访问用户的真实 IP。所以不仅仅是 HTTP 服务，任何的 TCP 服务，只要支持这一协议，都可以获得用户的真实 IP 地址。</p>
<p>需要注意的是，在代理配置中如果要启用此功能，需要本地的服务能够支持 <strong>Proxy Protocol</strong> 这一协议，目前 nginx 和 haproxy 都能够很好的支持。</p>
<p>这里以 https 类型为例:</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = https
local_port = 443
custom_domains = test.yourdomain.com

# 目前支持 v1 和 v2 两个版本的 proxy protocol 协议。
proxy_protocol_version = v2
</code></pre>
<p>只需要在代理配置中增加一行 <code>proxy_protocol_version = v2</code> 即可开启此功能。</p>
<p>本地的 https 服务可以通过在 nginx 的配置中启用 <strong>Proxy Protocol</strong> 的解析并将结果设置在 <code>X-Real-IP</code> 这个 Header 中就可以在自己的 Web 服务中通过 <code>X-Real-IP</code> 获取到用户的真实 IP。</p>
<h4>通过密码保护你的 web 服务</h4>
<p>由于所有客户端共用一个 frps 的 http 服务端口，任何知道你的域名和 url 的人都能访问到你部署在内网的 web 服务，但是在某些场景下需要确保只有限定的用户才能访问。</p>
<p>frp 支持通过 HTTP Basic Auth 来保护你的 web 服务，使用户需要通过用户名和密码才能访问到你的服务。</p>
<p>该功能目前仅限于 http 类型的代理，需要在 frpc 的代理配置中添加用户名和密码的设置。</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = http
local_port = 80
custom_domains = test.yourdomain.com
http_user = abc
http_pwd = abc
</code></pre>
<p>通过浏览器访问 <code>http://test.yourdomain.com</code>，需要输入配置的用户名和密码才能访问。</p>
<h4>自定义二级域名</h4>
<p>在多人同时使用一个 frps 时，通过自定义二级域名的方式来使用会更加方便。</p>
<p>通过在 frps 的配置文件中配置 <code>subdomain_host</code>，就可以启用该特性。之后在 frpc 的 http、https 类型的代理中可以不配置 <code>custom_domains</code>，而是配置一个 <code>subdomain</code> 参数。</p>
<p>只需要将 <code>*.{subdomain_host}</code> 解析到 frps 所在服务器。之后用户可以通过 <code>subdomain</code> 自行指定自己的 web 服务所需要使用的二级域名，通过 <code>{subdomain}.{subdomain_host}</code> 来访问自己的 web 服务。</p>
<pre><code class="language-ini"># frps.ini
[common]
subdomain_host = frps.com
</code></pre>
<p>将泛域名 <code>*.frps.com</code> 解析到 frps 所在服务器的 IP 地址。</p>
<pre><code class="language-ini"># frpc.ini
[web]
type = http
local_port = 80
subdomain = test
</code></pre>
<p>frps 和 frpc 都启动成功后，通过 <code>test.frps.com</code> 就可以访问到内网的 web 服务。</p>
<p><strong>注：如果 frps 配置了 <code>subdomain_host</code>，则 <code>custom_domains</code> 中不能是属于 <code>subdomain_host</code> 的子域名或者泛域名。</strong></p>
<p>同一个 http 或 https 类型的代理中 <code>custom_domains</code>  和 <code>subdomain</code> 可以同时配置。</p>
<h4>URL 路由</h4>
<p>frp 支持根据请求的 URL 路径路由转发到不同的后端服务。</p>
<p>通过配置文件中的 <code>locations</code> 字段指定一个或多个 proxy 能够匹配的 URL 前缀(目前仅支持最大前缀匹配，之后会考虑正则匹配)。例如指定 <code>locations = /news</code>，则所有 URL 以 <code>/news</code> 开头的请求都会被转发到这个服务。</p>
<pre><code class="language-ini"># frpc.ini
[web01]
type = http
local_port = 80
custom_domains = web.yourdomain.com
locations = /

[web02]
type = http
local_port = 81
custom_domains = web.yourdomain.com
locations = /news,/about
</code></pre>
<p>按照上述的示例配置后，<code>web.yourdomain.com</code> 这个域名下所有以 <code>/news</code> 以及 <code>/about</code> 作为前缀的 URL 请求都会被转发到 web02，其余的请求会被转发到 web01。</p>
<h4>TCP 端口复用类型</h4>
<p>frp 支持将单个端口收到的连接路由到不同的代理，类似 <code>vhost_http_port</code> 和 <code>vhost_https_port</code>。</p>
<p>目前支持的复用器只有 <code>httpconnect</code>。</p>
<p>当在 <code>frps.ini</code> 的 <code>[common]</code> 中设置 <code>tcpmux_httpconnect_port</code>，frps 将会监听在这个端口，接收 HTTP CONNECT 请求。</p>
<p>frps 会根据 HTTP CONNECT 请求中的 host 路由到不同的后端代理。</p>
<p>示例配置如下：</p>
<pre><code class="language-ini"># frps.ini
[common]
bind_port = 7000
tcpmux_httpconnect_port = 1337
</code></pre>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000

[proxy1]
type = tcpmux
multiplexer = httpconnect
custom_domains = test1

[proxy2]
type = tcpmux
multiplexer = httpconnect
custom_domains = test2
</code></pre>
<p>通过上面的配置，frps 如果接收到 HTTP CONNECT 请求内容:</p>
<pre><code>CONNECT test1 HTTP/1.1\r\n\r\n
</code></pre>
<p>该连接将会被路由到 proxy1 。</p>
<h4>通过代理连接 frps</h4>
<p>在只能通过代理访问外网的环境内，frpc 支持通过 HTTP PROXY 和 frps 进行通信。</p>
<p>可以通过设置 <code>HTTP_PROXY</code> 系统环境变量或者通过在 frpc 的配置文件中设置 <code>http_proxy</code> 参数来使用此功能。</p>
<p>仅在 <code>protocol = tcp</code> 时生效。</p>
<pre><code class="language-ini"># frpc.ini
[common]
server_addr = x.x.x.x
server_port = 7000
http_proxy = http://user:pwd@192.168.1.128:8080
</code></pre>
<h4>范围端口映射</h4>
<p>在 frpc 的配置文件中可以指定映射多个端口，目前只支持 tcp 和 udp 的类型。</p>
<p>这一功能通过 <code>range:</code> 段落标记来实现，客户端会解析这个标记中的配置，将其拆分成多个 proxy，每一个 proxy 以数字为后缀命名。</p>
<p>例如要映射本地 6000-6005, 6007 这6个端口，主要配置如下：</p>
<pre><code class="language-ini"># frpc.ini
[range:test_tcp]
type = tcp
local_ip = 127.0.0.1
local_port = 6000-6006,6007
remote_port = 6000-6006,6007
</code></pre>
<p>实际连接成功后会创建 8 个 proxy，命名为 <code>test_tcp_0, test_tcp_1 ... test_tcp_7</code>。</p>
<h4>客户端插件</h4>
<p>默认情况下，frpc 只会转发请求到本地 tcp 或 udp 端口。</p>
<p>客户端插件模式是为了在客户端提供更加丰富的功能，目前内置的插件有 <code>unix_domain_socket</code>、<code>http_proxy</code>、<code>socks5</code>、<code>static_file</code>。具体使用方式请查看<a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">使用示例</a>。</p>
<p>通过 <code>plugin</code> 指定需要使用的插件，插件的配置参数都以 <code>plugin_</code> 开头。使用插件后 <code>local_ip</code> 和 <code>local_port</code> 不再需要配置。</p>
<p>使用 <strong>http_proxy</strong> 插件的示例:</p>
<pre><code class="language-ini"># frpc.ini
[http_proxy]
type = tcp
remote_port = 6000
plugin = http_proxy
plugin_http_user = abc
plugin_http_passwd = abc
</code></pre>
<p><code>plugin_http_user</code> 和 <code>plugin_http_passwd</code> 即为 <code>http_proxy</code> 插件可选的配置参数。</p>
<h4>服务端管理插件</h4>
<p><a href="/doc/server_plugin_zh.md">使用说明</a></p>
<h3>开发计划</h3>
<p>计划在后续版本中加入的功能与优化，排名不分先后，如果有其他功能建议欢迎在 <a href="https://github.com/fatedier/frp/issues">issues</a> 中反馈。</p>
<ul>
<li>frps 记录 http 请求日志。</li>
</ul>
<h1>---------------- 分割线 以下是 0.21 版本时的记录 ------------------------------------</h1>
<h1>Background Knowledge</h1>
<p><a href="https://blog.csdn.net/zhangguo5/article/details/77848658?utm_source=5ibc.net&#x26;utm_medium=referral">一分钟实现内网穿透（ngrok服务器搭建）</a></p>
<h1>Source Code and Readme Document</h1>
<p><a href="https://github.com/fatedier/frp/blob/master/README_zh.md">github</a></p>
<h1>Server Install</h1>
<p><a href="https://blog.csdn.net/e_wsq/article/details/79405512">frp简易安装配置说明</a></p>
<ol>
<li>download</li>
</ol>
<pre><code>wget https://github.com/fatedier/frp/releases/download/v0.21.0/frp_0.21.0_linux_amd64.tar.gz
</code></pre>
<ol start="2">
<li>unzip</li>
</ol>
<pre><code>tar zxvf frp_0.21.0_linux_amd64.tar.gz
</code></pre>
<ol start="3">
<li>config frps.ini</li>
</ol>
<ul>
<li>command</li>
</ul>
<pre><code>vim frps.ini
</code></pre>
<ul>
<li>content</li>
</ul>
<pre><code># frps.ini
[common]
bind_port = 7000
vhost_http_port = 80
</code></pre>
<ol start="4">
<li>start service</li>
</ol>
<pre><code>./frps -c ./frps.ini
</code></pre>
<blockquote>
<p>You may want to save above command as a sh batch file.</p>
</blockquote>
<pre><code>#!/bin/bash
# start frp service

./frps -c ./frps.ini
</code></pre>
<h2>Aliyun Config</h2>
<blockquote>
<p>设置阿里云 ECS（xxx.xxx.xxx.xxx） 安全组规则：允许 7000 端口 以及 80 端口
阿里云域名解析 增加 A 记录：<a href="http://www.%5Bdomainname%5D.com">www.[domainname].com</a> ==>xxx.xxx.xxx.xxx</p>
</blockquote>
<h2>Client Install</h2>
<ol>
<li>download</li>
<li>config frpc.ini</li>
</ol>
<pre><code># frpc.ini
[common]
server_addr = xxx.xxx.xxx.xxx
server_port = 7000

[web]
type = http
local_port = 3000
custom_domains = www.[domainname].com
</code></pre>
<blockquote>
<p>Above is the configuration about web server. Below is the configuration about the tcp (from Xiaoyi Zhu).</p>
</blockquote>
<pre><code># frpc.ini
[common]
server_addr = xxx.xxx.xxx.xxx
server_port = 7000

[unix_domain_socket]
type = tcp
remote_port = 3000
plugin = unix_domain_socket
plugin_unix_path = /var/run/docker.sock
</code></pre>
<ol start="3">
<li>start frp client</li>
</ol>
<pre><code>frpc -c frpc.ini
</code></pre>
<blockquote>
<p>You may want to save above command as a bat file in the same folder of frpc.ext and frpc.ini.</p>
</blockquote>
<h2>Test</h2>
<ol>
<li>Start Web Server from local machine and listen port 3000</li>
</ol>
<pre><code>node app
</code></pre>
<ol start="2">
<li>Open Web Site from Browser</li>
</ol>
<blockquote>
<p>Input '<a href="http://www.%5Bdomainname%5D.com:80">http://www.[domainname].com:80</a>' in browser url address box.</p>
</blockquote>
<h2>Subdomain</h2>
<p>If you want to use sub domain, here is the case:</p>
<pre><code># frps.ini
[common]
bind_port = 7000
vhost_http_port = 80
subdomain_host = [sub domain name].com
</code></pre>
<pre><code># frpc.ini
[common]
server_addr = xxx.xxx.xxx.xxx
server_port = 7000

[web]
type = http
local_port = 3000
subdomain = [site name]
</code></pre>
<p>Example</p>
<pre><code># frps.ini

[common]
bind_port = 7000
vhost_http_port = 80
subdomain_host = frp.xxxx.com
</code></pre>
<pre><code># frpc.ini

[common]
server_addr = 107.151.172.73
server_port = 7000

[web]
type = http
local_port = 3000
subdomain = atlantis
</code></pre>
<h2>注意</h2>
<blockquote>
<p>如果服务器版本和客户端版本不一致，会引发报错，导致客户端无法启动</p>
</blockquote>
<blockquote>
<p>请检查最新版本的说明文档</p>
</blockquote></div></div><div style="flex:none;min-width:10rem"><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 hpfWsV dGDPjr"><table><tr><td><span class="ft-09">主题：</span><span class="ft-08">devops</span></td></tr><tr><td><span class="ft-09">创建：</span><span class="ft-08">2021-01-30</span></td></tr></table></div><div class="Common__Container-sc-qqf9b1-0 blog__Card-sc-1pczva4-1 cgUPym dGDPjr"><span class="blog__TagContainer-sc-1pczva4-3 gVCmfB"><span>frp</span><span>内网穿透</span></span></div></div></div></div></section><section color="#F3F9F1" style="min-height:6rem;gap:1em" class="Layout__Section-sc-1bdq7wd-3 eGASSl text-align-center"><div class="Layout__CenterContainer-sc-1bdq7wd-0 eNGrUK"><p class="ft-08">Wechat: yunzhi76</p><p class="ft-08" style="margin-top:.8em">Copyright © 2021 WeReady</p><p class="ft-08" style="margin-top:.8em">京ICP备17073797号</p></div></section></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/20210130002_frp";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-208afb513f08e06527a2.js"],"app":["/app-85ab217213fbdd0955c7.js"],"component---src-pages-component-button-tsx":["/component---src-pages-component-button-tsx-282a9d3fe357b8483082.js"],"component---src-pages-component-carousel-tsx":["/component---src-pages-component-carousel-tsx-6398286c02ad48627050.js"],"component---src-pages-component-highlight-tsx":["/component---src-pages-component-highlight-tsx-07a7ed2bcc3c5dc4794f.js"],"component---src-pages-component-image-tsx":["/component---src-pages-component-image-tsx-b71f4285664e37222ce6.js"],"component---src-pages-component-index-tsx":["/component---src-pages-component-index-tsx-2763bab35a7c5a48191e.js"],"component---src-pages-component-indicator-tsx":["/component---src-pages-component-indicator-tsx-5e987521c97c74b65d91.js"],"component---src-pages-component-link-tsx":["/component---src-pages-component-link-tsx-808637083ceb057c2f36.js"],"component---src-pages-component-list-tsx":["/component---src-pages-component-list-tsx-ace50f776069fa91dc77.js"],"component---src-pages-component-modal-tsx":["/component---src-pages-component-modal-tsx-82c52e91bf2dc5bcd514.js"],"component---src-pages-component-tag-tsx":["/component---src-pages-component-tag-tsx-0b7230821a3ad1178b0f.js"],"component---src-pages-form-choice-tsx":["/component---src-pages-form-choice-tsx-189d845e4b380025afdf.js"],"component---src-pages-form-demo-1-tsx":["/component---src-pages-form-demo-1-tsx-162bd636e81e659b680b.js"],"component---src-pages-form-demo-2-tsx":["/component---src-pages-form-demo-2-tsx-4b75b456aa4781cc1b7b.js"],"component---src-pages-form-demo-3-tsx":["/component---src-pages-form-demo-3-tsx-34b1c4543a6cbd240020.js"],"component---src-pages-form-demo-4-tsx":["/component---src-pages-form-demo-4-tsx-080195fab18e52441e08.js"],"component---src-pages-form-index-tsx":["/component---src-pages-form-index-tsx-57d6e048643840067b47.js"],"component---src-pages-form-login-tsx":["/component---src-pages-form-login-tsx-8015bbb567833fb6c864.js"],"component---src-pages-form-object-tsx":["/component---src-pages-form-object-tsx-e24c62f96d7b104ee30a.js"],"component---src-pages-form-reset-tsx":["/component---src-pages-form-reset-tsx-d6a7ba56ff0ad1184963.js"],"component---src-pages-hook-index-tsx":["/component---src-pages-hook-index-tsx-c2aabdadca8a3a05eea4.js"],"component---src-pages-hook-timer-tsx":["/component---src-pages-hook-timer-tsx-9dde7f8e70b414b1fe54.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-c70e171a90dfbcc87e8e.js"],"component---src-pages-uispec-color-tsx":["/component---src-pages-uispec-color-tsx-754ec307b4961371b041.js"],"component---src-pages-uispec-cssborder-tsx":["/component---src-pages-uispec-cssborder-tsx-bd793a11a5bc8de24c53.js"],"component---src-pages-uispec-divider-tsx":["/component---src-pages-uispec-divider-tsx-65136ae96e0311f509dd.js"],"component---src-pages-uispec-index-tsx":["/component---src-pages-uispec-index-tsx-096fa44f0c506cf24e6d.js"],"component---src-pages-uispec-layers-tsx":["/component---src-pages-uispec-layers-tsx-7248edfb7e318b87feed.js"],"component---src-pages-uispec-layout-tsx":["/component---src-pages-uispec-layout-tsx-b9063171d5e5f6b03659.js"],"component---src-pages-uispec-shadow-tsx":["/component---src-pages-uispec-shadow-tsx-798cd88a06b8b7b1e61a.js"],"component---src-pages-uispec-shape-tsx":["/component---src-pages-uispec-shape-tsx-3c4c2f54988a9a3f19b5.js"],"component---src-pages-uispec-svgicons-tsx":["/component---src-pages-uispec-svgicons-tsx-75399534198f789c8583.js"],"component---src-pages-uispec-typography-tsx":["/component---src-pages-uispec-typography-tsx-7866517d6738efa66c57.js"],"component---src-templates-blog-js":["/component---src-templates-blog-js-c289ae42e4b930074676.js"]};/*]]>*/</script><script src="/polyfill-208afb513f08e06527a2.js" nomodule=""></script><script src="/component---src-templates-blog-js-c289ae42e4b930074676.js" async=""></script><script src="/commons-25c08ee1fa984e3c32d5.js" async=""></script><script src="/app-85ab217213fbdd0955c7.js" async=""></script><script src="/framework-7818d66ac74a4e73b7d9.js" async=""></script><script src="/webpack-runtime-fdcbf6b17242e324ca08.js" async=""></script></body></html>